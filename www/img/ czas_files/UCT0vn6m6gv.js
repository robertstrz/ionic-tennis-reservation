/*!CK:4111949173!*//*1433852123,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["D2l\/Y"]); }

__d("Token",["CSS","DataStore","DOM","Locale","UnicodeBidi","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();function m(n,o){"use strict";this.info=n;this.paramName=o;}m.prototype.getInfo=function(){"use strict";return this.info;};m.prototype.getText=function(){"use strict";return this.info.text;};m.prototype.getValue=function(){"use strict";return this.info.uid;};m.prototype.isFreeform=function(){"use strict";return !!this.info.freeform;};m.prototype.setSelected=function(n){"use strict";g.conditionClass(this.getElement(),'uiTokenSelected',n);return this;};m.prototype.getElement=function(){"use strict";if(!this.element)this.setElement(this.createElement());return this.element;};m.prototype.setElement=function(n){"use strict";h.set(n,'Token',this);this.element=n;return this;};m.prototype.isRemovable=function(){"use strict";return g.hasClass(this.element,'removable');};m.prototype.getTextDirection=function(){"use strict";var n=k.isDirectionRTL(this.getText()),o=j.isRTL();if(n&&!o)return 'rtl';if(!n&&o)return 'ltr';return null;};m.prototype.createElement=function(n,o){"use strict";var p=this.paramName,q=this.getValue(),r=this.getText(),s=i.create('span',{className:'uiTokenText'},r),t=i.create('a',{href:'#','aria-label':l._("Usu\u0144 {item}",[l.param("item",r)]),className:'remove uiCloseButton uiCloseButtonSmall'});if(n)g.addClass(t,'uiCloseButtonSmallGray');var u=i.create('input',{type:'hidden',value:q,name:p+'[]',autocomplete:'off'}),v=i.create('input',{type:'hidden',value:r,name:'text_'+p+'[]',autocomplete:'off'}),w={className:'removable uiToken'},x=this.getTextDirection();if(x!==null)w.dir=x;var y=i.create('span',w,[s,u,v,t]);if(n)g.addClass(y,'uiTokenGray');if(o){var z=i.create('i',{className:o});i.prependContent(y,z);}return y;};e.exports=m;},null);
__d("WeakToken",["CSS","Token"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();for(var i in h)if(h.hasOwnProperty(i))k[i]=h[i];var j=h===null?null:h.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=h;function k(){"use strict";if(h!==null)h.apply(this,arguments);}k.prototype.createElement=function(){"use strict";var l=j.createElement.call(this,true,'UFIWeakReferenceIcon');g.addClass(l,'uiTokenWeakReference');return l;};e.exports=k;},null);
__d("Tokenizer",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","DOMQuery","Event","Focus","Input","Keys","Parent","StickyPlaceholderInput","Style","TextMetrics","Token","UserAgent_DEPRECATED","WeakToken","copyProperties","createObjectFrom","emptyFunction","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();var ba=20,ca=aa(h);for(var da in ca)if(ca.hasOwnProperty(da))fa[da]=ca[da];var ea=ca===null?null:ca.prototype;fa.prototype=Object.create(ea);fa.prototype.constructor=fa;fa.__superConstructor__=ca;function fa(ga,ha,ia){"use strict";this.element=ga;this.typeahead=ha;this.input=ha.getCore().getElement();if(ia)this.init(ia.tokenarea,ia.param_name,ia.initial_info,ia.options);j.set(this.element,'Tokenizer',this);}fa.prototype.init=function(ga,ha,ia,ja){"use strict";this._handleEvents=this.handleEvents.bind(this);this.init=z;this.setTokenarea(ga);this.paramName=ha;if(!this.placeholder)this.placeholder=this.input.getAttribute('data-placeholder')||this.input.getAttribute('placeholder')||'';x(this,ja||{});this.initEvents();this.initTypeahead();this.reset(ia);this.initBehaviors();setTimeout(this.adjustWidth.bind(this),0);g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);this.inform('init',{tokens:this.getTokens()});};fa.prototype.reset=function(ga){"use strict";this.tokens=[];this.unique={};if(ga){this.populate(ga);}else k.empty(this.tokenarea);this.updateTokenarea();};fa.prototype.populate=function(ga){"use strict";var ha=[];this.tokens=this.getTokenElements().map(function(ia,ja){var ka=ga[ja];ha.push(this._tokenKey(ka));return this.createToken(ka,ia);},this);this.unique=y(ha,this.tokens);};fa.prototype.setTokenarea=function(ga){"use strict";var ha=!this.tokenarea;if(ga!==this.tokenarea){if(this.tokenarea){k.remove(this.tokenarea);for(var ia in this._tokenareaListeners)this._tokenareaListeners[ia].remove();}this._tokenareaListeners=m.listen(ga,{click:this._handleEvents,keydown:this._handleEvents});this.tokenarea=ga;}if(!ha)this.reset();};fa.prototype.getElement=function(){"use strict";return this.element;};fa.prototype.getTypeahead=function(){"use strict";return this.typeahead;};fa.prototype.getInput=function(){"use strict";return this.input;};fa.prototype.initBehaviors=function(){"use strict";this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(ia){ia.behavior(this,ia.config);}.bind(this));}else for(var ga in (this.behaviors||{})){var ha=window.TokenizerBehaviors&&window.TokenizerBehaviors[ga];ha.call(null,this,this.behaviors[ga]);}};fa.prototype.initTypeahead=function(){"use strict";var ga=this.typeahead.getCore();ga.resetOnSelect=true;ga.setValueOnSelect=false;ga.preventFocusChangeOnTab=true;if(this.inline){var ha=this.typeahead.getView();i.addClass(ha.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(ia,ja){return this.handleSelect(ja);}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));};fa.prototype.handleBlur=function(event){"use strict";this.inform('blur',{event:event});this.updatePlaceholder();};fa.prototype.handleSelect=function(ga){"use strict";var ha=ga.selected;if('uid' in ha){this.updateInput();this.addToken(this.createToken(ha));}};fa.prototype.initEvents=function(){"use strict";var ga=v.firefox()<4?'keypress':'keydown';m.listen(this.input,'paste',this.paste.bind(this));m.listen(this.input,ga,this.keydown.bind(this));};fa.prototype.handleEvents=function(event){"use strict";var ga=event.getTarget(),ha=ga&&this.getTokenElementFromTarget(ga);if(!ha)return;if(event.type!='keydown'||m.getKeyCode(event)==p.RETURN)this.processEvents(event,ga,ha);};fa.prototype.processEvents=function(event,ga,ha){"use strict";if(q.byClass(ga,'remove')){var ia=ha.nextSibling;ia=ia&&l.scry(ha.nextSibling,'.remove')[0];var ja=this.getTokenFromElement(ha);ja=this.addTokenData(ja,ga);this.removeToken(ja);this.focusOnTokenRemoval(event,ia);event.kill();}};fa.prototype.focusOnTokenRemoval=function(event,ga){"use strict";n.set(event.type=='keydown'&&ga||this.input);};fa.prototype.addTokenData=function(ga,ha){"use strict";return ga;};fa.prototype.keydown=function(event){"use strict";this.inform('keydown',{event:event});var ga=m.getKeyCode(event),ha=this.input;if(this.inline&&ga==p.BACKSPACE&&o.isEmpty(ha)){var ia=this.getLastToken();if(ia&&ia.isRemovable())this.removeToken(ia);}this.updateInput();};fa.prototype.paste=function(event){"use strict";this.inform('paste',{event:event});this.updateInput(true);};fa.prototype.focusInput=function(){"use strict";n.set(this.input);};fa.prototype.updateInput=function(ga){"use strict";if(!this.inline)return;setTimeout(function(){this.adjustWidth(this.input.value);if(ga)this.input.value=this.input.value;}.bind(this),20);r.setPlaceholderText(this.input,'');this.inform('resize');};fa.prototype.setPlaceholder=function(ga){"use strict";this.placeholder=ga;if(this.stickyPlaceholder)r.setPlaceholderText(this.input,ga);this.updatePlaceholder();};fa.prototype.updatePlaceholder=function(){"use strict";if(!this.inline||this.input.value)return;var ga=!this.tokens.length,ha='';if(ga||this.stickyPlaceholder){this.adjustWidth(this.placeholder);ha=this.placeholder;}else this.adjustWidth(this.input.value);r.setPlaceholderText(this.input,ha);};fa.prototype.adjustWidth=function(ga){"use strict";if(!this.inline||!this._getIsInDOM())return;if(!ga&&this.input.value==='')ga=this.placeholder;var ha=ba;if(ga!==this.placeholder||!this.getTokens().length||this.stickyPlaceholder){var ia=s.getFloat(this.getElement(),'width'),ja=this._getMetrics().measure(ga);ha=ja.width+this._getWidthOffset()+10;ha=(ha>=ia)?ia:ha;}s.set(this.input,'width',ha+'px');this.inform('resize');g.inform('reflow');};fa.prototype.getToken=function(ga){"use strict";return this.unique[ga]||null;};fa.prototype.getTokens=function(){"use strict";return this.tokens||[];};fa.prototype.getTokenElements=function(){"use strict";return l.scry(this.tokenarea,'span.uiToken');};fa.prototype.getTokenElementFromTarget=function(ga){"use strict";return q.byClass(ga,'uiToken');};fa.prototype.getTokenFromElement=function(ga){"use strict";return j.get(ga,'Token');};fa.prototype.getTokenValues=function(){"use strict";if(!this.tokens)return [];return this.tokens.map(function(ga){return ga.getValue();});};fa.prototype.getFirstToken=function(){"use strict";return this.tokens[0]||null;};fa.prototype.getLastToken=function(){"use strict";return this.tokens[this.tokens.length-1]||null;};fa.prototype.hasMaxTokens=function(){"use strict";return this.maxTokens&&this.maxTokens<=this.tokens.length;};fa.prototype.createToken=function(ga,ha){"use strict";var ia=this.getToken(this._tokenKey(ga));if(!ia)ia=ga.weak_reference?new w(ga,this.paramName):new u(ga,this.paramName);ha&&ia.setElement(ha);return ia;};fa.prototype.addToken=function(ga){"use strict";if(this.hasMaxTokens())return;var ha=this._tokenKey(ga.getInfo());if(ha in this.unique)return;this.unique[ha]=ga;this.tokens.push(ga);this.insertToken(ga);this.updateTokenarea();this.inform('addToken',ga);this.inform('changeTokens');g.inform('Form/change',{node:this.element});};fa.prototype.insertToken=function(ga){"use strict";k.appendContent(this.tokenarea,ga.getElement());};fa.prototype.removeToken=function(ga){"use strict";if(!ga)return;var ha=this.tokens.indexOf(ga);if(ha<0)return;this.tokens.splice(this.tokens.indexOf(ga),1);delete this.unique[this._tokenKey(ga.getInfo())];k.remove(ga.getElement());this.updateTokenarea();this.inform('removeToken',ga);this.inform('changeTokens');g.inform('Form/change',{node:this.element});};fa.prototype.removeAllTokens=function(){"use strict";this.reset();this.inform('changeTokens');this.inform('removeAllTokens');};fa.prototype.updateTokenarea=function(){"use strict";var ga=this.typeahead.getCore(),ha=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=ga.getExclusions());ga.setExclusions(ha.concat(this._exclusions));}ga.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();this.inform('resize');g.inform('reflow');};fa.prototype.updateTokenareaVisibility=function(){"use strict";i.conditionShow(this.tokenarea,this.tokens.length!==0);};fa.prototype._tokenKey=function(ga){"use strict";return ga.uid+(ga.freeform?':':'');};fa.prototype._getWidthOffset=function(){"use strict";if(this._widthOffset===null){var ga=this.input.clientWidth,ha=s.getFloat(this.input,'width');if(ga==ha){this._widthOffset=s.getFloat(this.input,'paddingLeft')+s.getFloat(this.input,'paddingRight');}else this._widthOffset=0;}return this._widthOffset;};fa.prototype._getMetrics=function(){"use strict";if(!this._metrics)this._metrics=new t(this.input,this.inline);return this._metrics;};fa.prototype._getIsInDOM=function(){"use strict";return this._isInDOM||(this._isInDOM=l.contains(document.body,this.input));};fa.getInstance=function(ga){"use strict";var ha=q.byClass(ga,'uiTokenizer');return ha?j.get(ha,'Tokenizer'):null;};fa.init=function(ga,ha){"use strict";ga.init(ha.tokenarea,ha.param_name,ha.initial_info,ha.options);};x(fa.prototype,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',_widthOffset:null,_metrics:null});e.exports=fa;},null);
__d("XFamilyBulkTagAddAsyncController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/family\/bulk_tag_save\/",{subject:{type:"Int"},save_tags:{type:"String"}});},null);
__d("PhotoTagStore",["AsyncRequest","XFamilyBulkTagAddAsyncController","copyProperties","isEmpty"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(){"use strict";this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};k.instance=this;}k.prototype.getPhotoTags=function(l){"use strict";return this._tagList[l]||{};};k.prototype.photoHasTags=function(l){"use strict";return !j(this.getPhotoTags(l));};k.prototype.clear=function(){"use strict";this._tagList={};this._textTagList={};this._originalTagList={};this._dirtyPhotosByUid={};};k.prototype.addTag=function(l,m,n,o){"use strict";l[m]=l[m]||{};var p=l[m][n]||[];p.push(o);l[m][n]=p;};k.prototype.revert=function(l){"use strict";var m=this._tagList,n=this._originalTagList;for(var o in m)if(j(n[o][l])){m[o][l]=[];}else m[o][l]=n[o][l];this._dirtyPhotosByUid={};};k.prototype.hasNewTags=function(){"use strict";return !j(this._tagList)||!j(this._textTagList);};k.prototype.userHasDirtyTags=function(l){"use strict";return !j(this._dirtyPhotosByUid[l]);};k.prototype.userDirtyTagsCount=function(l){"use strict";return Object.keys(this._dirtyPhotosByUid[l]).length;};k.prototype.handleTagFetch=function(l){"use strict";for(var m in l)this.loadTagInfo(m,l[m]);};k.prototype.saveAlbumTagsForUser=function(l,m,n){"use strict";var o={},p=[],q=this._dirtyPhotosByUid[l]||{};for(var r in q){var s=this._tagList[r][l];if(j(s)){p[p.length]=r;continue;}s.forEach(function(v){o[r]={x:v.x,y:v.y};});}var t={subject:l,action:'save',save_tags:o},u='/ajax/photos/album/tags.php';if(n){t={subject:l,save_tags:JSON.stringify(o)};u=h.getURIBuilder().getURI();}new g().setURI(u).setData(t).setHandler(function(v){m(v.payload);}).setAllowCrossPageTransition(true).send();delete this._dirtyPhotosByUid[l];};k.prototype.getTagsFromList=function(l){"use strict";var m=[];for(var n in l)if(l.hasOwnProperty(n))for(var o in l[n])if(l[n].hasOwnProperty(o))l[n][o].forEach(function(p){return m.push(p);});return m;};k.prototype.getAllTags=function(){"use strict";var l=this.getTagsFromList(this._tagList),m=this.getTagsFromList(this._textTagList);return l.concat(m);};k.prototype.removeTag=function(l,m){"use strict";var n=this._tagList[l],o=this._originalTagList[l]||{};if(o[m]){this._dirtyPhotosByUid[m]=this._dirtyPhotosByUid[m]||{};this._dirtyPhotosByUid[m][l]=true;}else delete this._dirtyPhotosByUid[m][l];for(var p in n)if(p==m){var q=this._tagList[l][p];delete this._tagList[l][p];if(j(this._tagList[l]))delete this._tagList[l];return q;}};k.prototype.removeTextTag=function(l,m){"use strict";var n=this._textTagList[l];if(!j(n[m])){var o=this._textTagList[l][m];this._textTagList[l][m]=[];if(j(this._textTagList[l]))delete this._textTagList[l];return o;}return [];};k.prototype.removeAllNewTagsOfUser=function(l){"use strict";var m=[];if(!this.userHasDirtyTags(l))return m;var n=this._dirtyPhotosByUid[l];for(var o in n)m=m.concat(this.removeTag(o,l));return m;};k.prototype.removeAllTagsFromPhoto=function(l){"use strict";var m=[];if(!j(this._tagList[l]))for(var n in this._tagList[l]){if(!this._tagList[l].hasOwnProperty(n))continue;m=m.concat(this.removeTag(l,n));}if(!j(this._textTagList[l]))for(var o in this._textTagList[l]){if(!this._textTagList[l].hasOwnProperty(o))continue;m=m.concat(this.removeTextTag(l,o));}return m;};k.prototype.storeTag=function(l,m,n,o,p){"use strict";this.storeTagWithOptions(l,m,n,o,{can_remove:p});};k.prototype.storeTagWithOptions=function(l,m,n,o,p){"use strict";this._dirtyPhotosByUid[m]=this._dirtyPhotosByUid[m]||{};this._dirtyPhotosByUid[m][l]=true;var q={x:n,y:o};i(q,p);if(!m){this.addTag(this._textTagList,l,q.name,q);}else this.addTag(this._tagList,l,m,q);};k.prototype.loadTagInfo=function(l,m){"use strict";this._tagList[l]={};this._originalTagList[l]={};for(var n=0;n<m.length;n++){var o=m[n];this.addTag(this._tagList,l,o.subject,o);this.addTag(this._originalTagList,l,o.subject,o);}};k.getInstance=function(){"use strict";if(k.instance===null)new k();return k.instance;};k.instance=null;e.exports=k;},null);
__d("TypeaheadPreventSubmitOnEnter",["Event","Keys","copyProperties"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this._typeahead=k;}j.prototype.enable=function(){"use strict";var k=this._typeahead.getCore().getElement();this._listener=g.listen(k,'keypress',function(l){if(g.getKeyCode(l)==h.RETURN)l.kill();});};j.prototype.disable=function(){"use strict";this._listener.remove();this._listener=null;};i(j.prototype,{_listener:null});e.exports=j;},null);
__d("TypeaheadShowResultsOnFocus",["Event","Keys","copyProperties"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k){"use strict";this._typeahead=k;}j.prototype.enable=function(){"use strict";this._typeahead.getCore().resetOnKeyup=false;this._subscription=this._typeahead.subscribe('bootstrap',function(k,l){this.firstFetch(l,this._typeahead.getCore(),this._typeahead.getData());}.bind(this));this._keyUpListener=g.listen(this._typeahead.getCore().getElement(),'keyup',function(event){if(g.getKeyCode(event)==h.BACKSPACE||g.getKeyCode(event)==h.DELETE)this.respond(this._typeahead.getCore(),this._typeahead.getData());}.bind(this));this._focusListener=g.listen(this._typeahead.getCore().getElement(),'focus',function(event){this.respond(this._typeahead.getCore(),this._typeahead.getData());}.bind(this));};j.prototype.disable=function(){"use strict";this._typeahead.unsubscribe(this._subscription);this._subscription=null;this._keyUpListener.remove();this._keyUpListener=null;this._focusListener.remove();this._focusListener=null;};j.prototype.firstFetch=function(k,l,m){"use strict";!k.bootstrapping&&this.respond(l,m);};j.prototype.respond=function(k,l){"use strict";if(!k.getValue()){var m=this.getUidsFromData(l);k.setValue('');var n=l.buildUids(' ',m);l.respond('',n);}};j.prototype.getUidsFromData=function(k){"use strict";var l=k.getAllEntries(),m=[];for(var n in l)m.push({uid:l[n].uid,index:l[n].index});m.sort(function(o,p){return o.index-p.index;});return m.map(function(o){return o.uid;});};i(j.prototype,{_subscription:null,_keyUpListener:null,_focusListener:null});e.exports=j;},null);