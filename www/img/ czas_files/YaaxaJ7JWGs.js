/*!CK:2939654943!*//*1433729749,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["HHSS7"]); }

__d("P2PTriggersUtils",["CurrentEnvironment","MercuryIDs","P2PGKValues","P2PQEValues"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=/\$((\d{1,3}(,\d{3})*)|\d+)(\.\d{1,2})?(?=\s|\.\s|\,\s|$|\.$|\,$|\?|\!|\")/,l={canSeeTriggers:function(m){if(!j.P2PMessageTriggersEnabled)return false;if(h.isGroupChat(m))if(g.messengerdotcom&&!i.P2PGroupSendMessengerDotCom){return false;}else if(g.facebookdotcom&&!i.P2PGroupSendWWW)return false;return true;},getMatches:function(m){return m.match(k);}};e.exports=l;},null);
__d("MessengerHotLikePreviewEvents",["mixInEventEmitter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';var h={START:'start',STOP:'stop',POP:'pop'};g(h,{start:true,stop:true,pop:true});e.exports=h;},null);
__d("ChatTabMessagesView",["Animation","Arbiter","BanzaiLogger","BootloadedComponent.react","Bootloader","ChatConfig","ChatConversation.react","ChatPerfInstrumentation","ChatTabViewEvents","ChatWelcomeMessage","CSS","DOM","Event","MercuryLastMessageIndicator.react","LiveTimer","MessengerHotLikePreviewEvents","MercuryViewer","MercuryMessageStore","React","Scroll","ServerTime","StickerActions","StickerState","StickerStoreController","Style","SubscriptionsHandler","UserAgent_DEPRECATED","arrayContains","copyProperties","getElementPosition","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){b.__markCompiled&&b.__markCompiled();'use strict';var la=70,ma=null,na=20;function oa(qa){if(ma===null){var ra=qa.childNodes[0];ea.set(qa,'overflow','scroll');ma=ra.clientWidth-la;ea.set(qa,'overflow','');}return ma;}function pa(qa,ra,sa,ta,ua,va,wa,xa){this.loadingIcon=ua;this.threadID=qa;this.sheetController=ra;this.scrollContainer=sa;this.conversationElem=ta;this.tabView=xa;u.restart(aa.get()/1000);this._loadingMoreMessages=false;this._initialLoadFinished=false;function ya(){o.inform('interaction-with-tab',qa);}this._subscriptions=new fa();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),s.listen(this.scrollContainer,'mousedown',ya));if(ga.firefox()){var za=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(za,ya,false);}else this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'mousewheel',ya));this._subscriptions.addSubscriptions(s.listen(this.scrollContainer,'scroll',ka(this.scrolling,50,this)));if(l.get('chat_react')){var ab;y.render(y.createElement(j,{bootloadPlaceholder:y.createElement("span",null),bootloadComponent:function(cb){k.loadModules(["ChatTypingIndicators.react"],cb);},threadID:this.threadID,indicatorsWillShow:function(){return ab=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return ab&&this.scrollToBottom(true);}.bind(this)}),wa);}else k.loadModules(["MercuryTypingIndicator"],function(cb){this.typingIndicator=new cb(this.threadID,wa,this);}.bind(this));var bb;this.lastMessageIndicatorNode=va;this.lastMessageIndicator=y.render(y.createElement(t,{threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return bb=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return bb&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);this.initializeConversation();}ia(pa.prototype,{initializeConversation:function(){this._store=new x(this.threadID);this._conversation=y.render(y.createElement(m,{maxBubbleWidth:oa(this.scrollContainer),messages:[],onImageLoad:function(qa){var ra=this.scrollContainer,sa=z.getTop(ra)+ra.clientHeight;if(sa+qa.offsetHeight>=ra.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(qa,ra,sa){o.inform('video-call-clicked',{userID:qa,threadID:ra,clickSource:sa});}}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(this._updateMessageFromStore.bind(this)),v.addListener(v.START,function(qa,ra){if(this.threadID!==ra)return;this._likePreview=qa;this._conversation.setProps({messages:this._getNormalizedMessages()},this.scrollToBottom.bind(this));this.scrollToBottom();this._scrollToBottomInterval=setInterval(this.scrollToBottom.bind(this),50);}.bind(this)),v.addListener(v.STOP,function(qa){if(this.threadID!==qa)return;this._likePreview=null;clearInterval(this._scrollToBottomInterval);}.bind(this)),v.addListener(v.POP,function(qa){if(this.threadID!==qa)return;clearInterval(this._scrollToBottomInterval);this._likePreview=null;this._conversation.setProps({messages:this._getNormalizedMessages()});}.bind(this)));},_updateMessageFromStore:function(qa){if(qa.eventType==x.MESSAGES_RECEIVED&&qa.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(qa.eventType==x.MESSAGES_REORDERED){this._loadingMoreMessages=false;q.hide(this.loadingIcon);}var ra=this.isScrolledToBottom(),sa=this._getLoadingHeight(),ta=this.scrollContainer.scrollHeight,ua=z.getTop(this.scrollContainer);this._messages=qa.messages;var va=p.getWelcomeMessage(this.threadID);if(va)this._messages.push(va);this._conversation.setProps({messages:this._getNormalizedMessages()},function(){if(ra||this._shouldScrollToBottom){this.scrollToBottom();this.setShouldScrollToBottom(false);}else if(qa.eventType==x.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-ta-sa+ua);if(!this._initialLoadFinished){this._initialLoadFinished=true;n.logCHAT_CONVERSATION_TTI();}}.bind(this));this.lastMessageIndicator.setProps({lastMessage:this._messages.length>0?this._messages[this._messages.length-1]:null});if(qa.eventType==x.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(this._messages)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();if(qa.eventType==x.MESSAGES_CHANGED)this._checkToAnimateSticker();},setShouldScrollToBottom:function(qa){this._shouldScrollToBottom=qa;},scrolling:function(){this._checkToAnimateSticker();if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){q.show(this.loadingIcon);this._loadingMoreMessages=true;}if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&z.getTop(this.scrollContainer);},destroy:function(){r.scry(this.conversationElem,'.stickerContainer').forEach(function(qa){return y.unmountComponentAtNode(qa);});y.unmountComponentAtNode(this.conversationElem);this._subscriptions&&this._subscriptions.release();y.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;this._store&&this._store.destroy();this.destroyed=true;},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_shouldShowStickerReplyNUX:function(qa){if(!ca.shouldShowStickerReplyNUX()||!qa.length)return false;var ra=qa[qa.length-1];if(ra.author===w.getID())return false;if(ra.has_attachment)return ra.attachments.some(function(sa){return sa.attach_type==='sticker';});return false;},isScrolledToBottom:function(qa){var ra=this.scrollContainer;qa=qa||na;return z.getTop(ra)+ra.clientHeight>=ra.scrollHeight-qa;},isScrolledNearTop:function(){return z.getTop(this.scrollContainer)<this.scrollContainer.clientHeight;},scrollToBottom:function(qa){this.scrollToPosition(this.scrollContainer.scrollHeight,qa);},scrollToPosition:function(qa,ra){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(ra===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',qa).ease(g.ease.end).duration(400).go();}else z.setTop(this.scrollContainer,qa);},_onStickerClick:function(qa,ra){if(!qa)return;i.log('StickersLoggerConfig',{event:'click_sticker',packid:qa,stickerid:ra});var sa=this.tabView;ca.onTrayDataReady(function(){if(ha(ca.getPackIDsInTray(),qa)){var ta=ca.getPack(qa);if(ta&&ta.isPromoted)ba.addPack(qa);sa.setStickersFlyoutPackID(qa);}else da.showStore(qa);});},_checkToAnimateSticker:function(){var qa=ja(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:z.getTop(this.scrollContainer),top:qa.y,viewHeight:qa.height});},setNewThreadID:function(qa){this._store.setNewThreadID(qa);},_getNormalizedMessages:function(){if(this._likePreview){this._messages.push(this._likePreview);}else this._messages=this._messages.filter(function(qa){return !qa.is_like_preview;});return this._messages;}});e.exports=pa;},null);
__d("ChatEmployeeAwaySheet",["ArbiterMixin","DOM","mixin","ChatTabTemplates"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=i(g);for(var l in k)if(k.hasOwnProperty(l))n[l]=k[l];var m=k===null?null:k.prototype;n.prototype=Object.create(m);n.prototype.constructor=n;n.__superConstructor__=k;function n(o,p,q){"use strict";this.$ChatEmployeeAwaySheet0=o;this.$ChatEmployeeAwaySheet1=p;this.$ChatEmployeeAwaySheet2=q;}n.prototype.render=function(){"use strict";var o=j[':fb:mercury:employee-away-sheet'].build();h.setContent(this.$ChatEmployeeAwaySheet1,o.getRoot());};n.prototype.isPermanent=function(){"use strict";return true;};n.prototype.getType=function(){"use strict";return 'employee-away';};n.prototype.open=function(){"use strict";this.$ChatEmployeeAwaySheet2.open(this);};n.prototype.close=function(){"use strict";this.$ChatEmployeeAwaySheet2.close(this);};e.exports=n;},null);