/*!CK:2007261511!*//*1434123728,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["yjURP"]); }

__d("MercurySendMessageFields",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={AUTO_RETRY_CNT:"auto_retry_cnt",MANUAL_RETRY_CNT:"manual_retry_cnt"};},null);
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;},null);
__d("OrderedFriendsList",["AvailableListConstants","PresenceStatus","SearchableEntry","ShortProfiles","WorkModeConfig","createArrayFromMixed","isValidUniqueID","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n=[],o=[],p={},q=[],r={},s=[],t={contains:function(u){return u in p;},getList:function(){if(k.is_work_user)return l(n);t.reRank();var u=l(n);u=u.filter(function(v){var w=j.getNowUnsafe(v);return !w||w.type=="friend";});return u;},getSearchableEntries:function(u,v){var w=t.getList();j.getMulti(w.slice(0,u),function(x){var y=[];for(var z in x)y.push(t.normalizeProfileEntry(x[z]));var aa=t.getGroups().map(t.normalizeThreadEntry);v(y.concat(aa).filter(function(ba){return !!ba;}).sort(function(ba,ca){return ba.getOrder()-ca.getOrder();}));});},normalizeProfileEntry:function(u){var v=u.searchTokens||[];return new i({uniqueID:u.id,keywordString:v.join(' '),order:t.getRank(u.id),photo:u.thumbSrc,title:u.name,type:u.type,uri:u.uri,auxiliaryData:{isMessengerUser:u.is_messenger_user}});},normalizeThreadEntry:function(u,v){var w=u.mercury_thread,x=u.participants_to_render,y=u.text,z=null;if(!y)y=w.name;var aa=x.map(function(ca){return ca.name;}).join(', ');if(!y){y=aa;}else z=aa;var ba=u.uid;if(!y||!m(ba))return null;return new i({uniqueID:ba,order:v,photo:w.image_src,title:y,subtitle:z,type:'thread',auxiliaryData:{participantsToRender:x,thread:w}});},getRank:function(u){return u in p?p[u]:n.length;},getActiveList:function(){if(q.length>0)return q;return t.getList();},getActiveRank:function(u){return u in r?r[u]:t.getRank(u);},reRank:function(){n=[];var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(h.get(w)==x){n[u]=w;p[w]=u++;}});},rankActive:function(){var u=0;s.forEach(function(v){var w=v.slice(0,-2),x=v.slice(-1);if(x==g.ACTIVE){q[u]=w;r[w]=u++;}});},getGroups:function(){return o;}};(function(){var u=b('InitialChatFriendsList');n=u.list.length?u.list:[];o=u.groups||[];if(!k.is_work_user){s=n.slice();t.rankActive();t.reRank();}else n.forEach(function(v,w){p[v]=w;});})();e.exports=a.OrderedFriendsList||t;},null);
__d("ChatDispatcher",["Dispatcher"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';e.exports=new g();},null);
__d("ChatSidebarActions",["ChatDispatcher","keyMirror"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h({HIDE:null,SET_ENABLED:null,SHOW:null,TOGGLE:null}),j={Types:i,disable:function(){g.dispatch({type:i.SET_ENABLED,enabled:false});},enable:function(){g.dispatch({type:i.SET_ENABLED,enabled:true});},hide:function(){g.dispatch({type:i.HIDE});},show:function(){g.dispatch({type:i.SHOW});},toggle:function(){g.dispatch({type:i.TOGGLE});}};e.exports=j;},null);
__d("FluxStore",["EventEmitter","invariant"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i='change';function j(k){var l=this.constructor;this.__className=l.name;this.__changed=false;this.__dispatcher=k;this.__changeEvent=this.$FluxStore0();this.__emitter=new g();this.$FluxStore1=k.register(function(m){this.__invokeOnDispatch(m);}.bind(this));}j.prototype.addListener=function(k){return this.__emitter.addListener(this.__changeEvent,k);};j.prototype.getDispatcher=function(){return this.__dispatcher;};j.prototype.getDispatchToken=function(){return this.$FluxStore1;};j.prototype.hasChanged=function(){h(this.__dispatcher.isDispatching());return this.__changed;};j.prototype.__emitChange=function(){h(this.__dispatcher.isDispatching());this.__changed=true;};j.prototype.__invokeOnDispatch=function(k){this.__changed=false;this.__onDispatch(k);if(this.__changed)this.__emitter.emit(this.__changeEvent);};j.prototype.__onDispatch=function(k){h(false);};j.prototype.$FluxStore0=function(){return i;};e.exports=j;},null);
__d("ChatSidebarStore",["ChatDispatcher","ChatOptions","ChatSidebarActions","FluxStore"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';for(var k in j)if(j.hasOwnProperty(k))m[k]=j[k];var l=j===null?null:j.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=j;function m(){j.call(this,g);this.$ChatSidebarStore0={visible:true,enabled:!!h.getSetting('sidebar_mode')};}m.prototype.__onDispatch=function(n){var o=n.type,p=Object.assign({},this.$ChatSidebarStore0);switch(o){case i.Types.HIDE:this.$ChatSidebarStore0.visible=false;break;case i.Types.SHOW:this.$ChatSidebarStore0.visible=true;break;case i.Types.SET_ENABLED:this.$ChatSidebarStore0.enabled=n.enabled;break;case i.Types.TOGGLE:this.$ChatSidebarStore0.enabled=!this.$ChatSidebarStore0.enabled;break;}for(var q in this.$ChatSidebarStore0)if(this.$ChatSidebarStore0.hasOwnProperty(q))if(this.$ChatSidebarStore0[q]!==p[q]){this.__emitChange();break;}};m.prototype.getState=function(){return this.$ChatSidebarStore0;};e.exports=new m();},null);
__d("ChatSidebarOptionsListener",["Arbiter","ChatOptions","ChatSidebarActions","ChatSidebarStore"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k={listen:function(){g.subscribe('chat/option-changed',function(l,m){if(m.name==='sidebar_mode'){var n=!!h.getSetting('sidebar_mode');if(n===j.getState().enabled)return;if(n){i.enable();}else i.disable();}});}};e.exports=k;},null);
__d("ChatSidebarComposeLink.react",["ChatOpenTab","React","TooltipLink.react","URI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=h,m=l.PropTypes,n=h.createClass({displayName:"ChatSidebarComposeLink",propTypes:{className:m.string.isRequired},componentDidMount:function(){g.listenOpenEmptyTab(h.findDOMNode(this),'sidebar');},render:function(){var o=k._("Nowa wiadomo\u015b\u0107");return (h.createElement(i,{ajaxify:new j('/ajax/messaging/composer.php'),className:this.props.className,tooltip:o,rel:"dialog"}));}});e.exports=n;},null);
__d("ChatSidebarConstants",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={LITESTAND_CLASSIC_SIZE:32,IMAGE_SIZE:28};Object.assign(g,{getImageSize:function(h){if(h===false)return g.IMAGE_SIZE;return g.LITESTAND_CLASSIC_SIZE;},getItemHeight:function(h){if(h===false)return g.IMAGE_SIZE+4;return g.LITESTAND_CLASSIC_SIZE+4;}});e.exports=g;},null);
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","copyProperties","MercuryConstants"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=b('MercuryConstants').ChatNotificationConstants,l=false,m=h.getWebChatNotification(),n=l,o=true,p=j(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;},showsTabUnreadUI:function(){return o;}});function q(){p.inform(p.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var r=m,s=h.getWebChatNotification();m=s;if(r!=s)q();});g.subscribe('chat/set_does_page_occlude_tabs',function(r,s){n=!!s;q();});g.subscribe('chat/set_show_tab_unread_ui',function(r,s){o=!!s;q();});e.exports=p;},null);
__d("ChatSidebarSheetChatOffline.react",["Link.react","React","ReactComponentWithPureRenderMixin","fbt"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();'use strict';var k=h,l=k.PropTypes,m=h.createClass({displayName:"ChatSidebarSheetChatOffline",mixins:[i],propTypes:{onGoOnlineClick:l.func.isRequired},render:function(){return (h.createElement("div",null,j._("{=Go online}, aby zobaczy\u0107, kto jest dost\u0119pny.",[j.param("=Go online",h.createElement(g,{className:"fbChatGoOnlineLink",onClick:this.props.onGoOnlineClick},j._("W\u0142\u0105cz czat")))])));}});e.exports=m;},null);
__d("ChatSidebarSheet",["ArbiterMixin","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatSidebarSheetChatOffline.react","ChatVisibility","CSS","DOM","Event","JSLogger","PresencePrivacy","React","copyProperties","fbt","mixin","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();var x=q.create('sidebar_sheet');function y(ea){switch(ea){case i.HINT_AUTH:return u._("Sesja wygas\u0142a. Zaloguj si\u0119 ponownie.");case i.HINT_CONN:return u._("{Chat} Facebooka jest obecnie niedost\u0119pny.",[u.param("Chat",u._("Czat"))]);case i.HINT_MAINT:return u._("{Chat} Facebooka jest obecnie poddawany czynno\u015bciom konserwacyjnym.",[u.param("Chat",u._("Czat"))]);default:return u._("{Chat} Facebooka jest obecnie niedost\u0119pny.",[u.param("Chat",u._("Czat"))]);}}function z(ea){var fa;if(ea===null||false===navigator.onLine){fa=u._("Nie mo\u017cna po\u0142\u0105czy\u0107 z czatem. Sprawd\u017a po\u0142\u0105czenie z internetem.");}else if(ea>k.get('warning_countdown_threshold_msec')){var ga=o.create('a',{href:'#',className:'fbChatReconnectLink'},u._("Spr\u00f3buj ponownie"));fa=u._("Nie mo\u017cna po\u0142\u0105czy\u0107 z czatem. {try-again-link}",[u.param("try-again-link",ga)]);}else if(ea>1000){fa=u._("Nie mo\u017cna po\u0142\u0105czy\u0107 z czatem. Pr\u00f3ba ponownego nawi\u0105zania po\u0142\u0105czenia za {seconds} sekund...",[u.param("seconds",Math.floor(ea/1000))]);}else fa=u._("Nie mo\u017cna po\u0142\u0105czy\u0107 z czatem. Pr\u00f3ba ponownego nawi\u0105zania po\u0142\u0105czenia...");return fa;}var aa=v(g);for(var ba in aa)if(aa.hasOwnProperty(ba))da[ba]=aa[ba];var ca=aa===null?null:aa.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=aa;function da(ea){"use strict";this._root=ea;this._message=o.find(ea,'div.fbChatSidebarMessage div.message');h.subscribe([h.CONNECTED,h.SHUTDOWN,h.RECONNECTING],this._handleConnectionChange.bind(this));h.subscribe([h.MUTE_WARNING,h.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));j.subscribe(j.ON_CHANGED,this._render.bind(this));this._render();}da.prototype._handleConnectionChange=function(ea,fa){"use strict";this._channelStatus=ea;this._channelData=fa;this._render();};da.prototype._renderChannelDisconnect=function(){"use strict";if(this._channelStatus===h.SHUTDOWN){return o.setContent(this._message,y(this._channelData));}else if(this._channelStatus===h.RECONNECTING){var ea=this._channelData;o.setContent(this._message,z(ea));if(ea>1000){if(ea>k.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){h.reconnect();return false;}});this._showWarningTimeout=w(this._handleConnectionChange.bind(this,h.RECONNECTING,ea-1000),1000);}}};da.prototype._renderOffline=function(){"use strict";return s.render(s.createElement(l,{onGoOnlineClick:function(ea){x.log('sidebar_go_online');m.goOnline();}}),this._message);};da.prototype._clear=function(){"use strict";if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'offline');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);};da.prototype._render=function(){"use strict";this._clear();if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(h.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!j.notifiesUserMessages()){n.addClass(this._root,'notice');var ea=u._("Powiadomienia s\u0105 wy\u0142\u0105czone w czasie korzystania z innego klienta do obs\u0142ugi czatu.");o.setContent(this._message,ea);}this.inform('updated');};t(da.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});e.exports=da;},null);
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;},null);
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","BanzaiODS","Bootloader","ChatConfig","ChatImpressionLogger","ChatOptions","ChatSidebarActions","ChatSidebarOptionsListener","ChatSidebarComposeLink.react","ChatSidebarConstants","ChatSidebarSheet","ChatSidebarStore","CSS","DOM","DOMDimensions","Event","JSLogger","KeyEventController","LitestandClassicPlaceHolders","MercuryConfig","OrderedFriendsList","Parent","PresencePrivacy","React","ScrollableArea","SidebarFitWindowHeight","Style","ViewportBounds","copyProperties","createArrayFromMixed","csx","cx","debounce","emptyFunction","ge","performanceAbsoluteNow"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra){b.__markCompiled&&b.__markCompiled();var sa='chat_sidebar_visibility',ta,ua=null,va,wa=false,xa=false,ya=false,za=false,ab=false,bb=false,cb,db,eb=false,fb,gb,hb,ib,jb,kb,lb,mb=null,nb,ob=y.create('chat_sidebar');j.setEntitySample(sa,.0001);function pb(){u.removeClass(document.documentElement,'sidebarMode');if(!ab||(!ac.isVisible()&&!za)){g.inform('reflow');return;}ya=false;za=false;mb=null;ib.hide();kb.getCore().reset();u.hide(gb);if(eb){u.hide(db);u.hide(fb);u.removeClass(document.documentElement,'miniSidebar');u.removeClass(gb,"_51xq");cb&&cb.setProps({shown:false},function(){return vb(false);});ob.log('minisidebar_hide');}else ob.log('sidebar_hide');g.inform('sidebar/hide',ac);g.inform('reflow');}function qb(){var bc=ac.shouldShowSidebar(),cc=ac.shouldShowMiniSidebar();if(ac.isEnabled()&&(bc||cc)){if(bc){tb();ub();}else wb();}else pb();if(!ab){zb();ab=true;}mb=null;}function rb(){if(kb&&ac.isVisible())kb.getCore().getElement().focus();}function sb(bc){var cc=lb.height;bc.forEach(function(dc){if(dc&&dc!==ta)cc-=w.getElementDimensions(dc).height;});if(nb)cc-=nb.getOffset();if(jb)cc-=w.getElementDimensions(jb).height;return Math.max(0,cc);}function tb(){if(ac.isVisible())return;if(eb){u.hide(db);u.show(fb);u.removeClass(document.documentElement,'miniSidebar');u.removeClass(gb,"_51xq");cb&&cb.setProps({shown:false},function(){return vb(false);});}ya=true;za=false;mb=null;u.show(gb);u.addClass(document.documentElement,'sidebarMode');ib.show();ob.log('sidebar_show');g.inform('sidebar/show',ac);aa.destroy('sidebar');}function ub(){var bc=sb(la(fb.childNodes)),cc=ib.getItemHeight(),dc=8,ec=Math.floor((bc-dc)/cc);ia.set(ta,'height',bc+'px');ib.setNumTopFriends(ec);if(ba.ScrollableSidebarTypeaheadGK){kb.getView().setMaxHeight(bc);}else{var fc=Math.floor((bc-dc)/cc);fc=(fc-2)>0?fc-2:0;kb.getData().setMaxResults(fc);}g.inform('sidebar/resized',ac);g.inform('reflow');}function vb(bc){if(gb===null)return;u.conditionClass(gb,"_2e4g",bc);}function wb(){u.hide(fb);u.show(db);u.show(gb);u.addClass(document.documentElement,'sidebarMode');u.addClass(document.documentElement,'miniSidebar');u.addClass(gb,"_51xq");var bc=sb([]),cc=r.getItemHeight(true),dc=Math.floor(bc/cc)-4;if(!cb){k.loadModules(["ChatMiniSidebar.react","ChatMiniSidebarSearchSource"],function(ec,fc){if(!va)va=new fc({queryRequests:[{uri:'/ajax/mercury/composer_query.php'}]});cb=fa.render(fa.createElement(ec,{dataSource:va,height:bc,maxEntries:Math.max(dc,0),onClickSearch:vb,onToggleSidebar:ac.toggle,shown:true}),db);});}else cb.setProps({height:bc,maxEntries:Math.max(dc,0),shown:true});ya=false;za=true;aa.destroy('sidebar');ob.log('minisidebar_show');g.inform('minisidebar/show',ac);g.inform('reflow');}function xb(){n.setSetting('sidebar_mode',ac.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(pa).setErrorHandler(pa).setData({sidebar_mode:ac.isEnabled()}).setAllowCrossPageTransition(true).send();}function yb(){return ca.getActiveList().length<=l.get('sidebar.min_friends');}function zb(){var bc=true;if(!ac.isEnabled()){ob.log('state_not_enabled');bc=false;}if(!ac.isViewportCapable())if(!eb){ob.log('state_not_shown_viewport');bc=false;}else if(!ac.isViewportCapableForMiniSidebar()){ob.log('state_not_shown_viewport_mini');bc=false;}if(bc)j.bumpEntityKey(sa,'state_viewport_can_show');if(xa){ob.log('state_not_shown_hidden');bc=false;}if(yb()){ob.log('state_not_shown_num_friends');bc=false;}var cc=bc?'state_shown':'state_not_shown';ob.log(cc);j.bumpEntityKey(sa,cc);}var ac={init:function(bc,cc,dc,ec){ac.init=pa;this._initTime=ra();bb=true;gb=bc;ib=cc;kb=dc;hb=ec;ta=v.find(bc,'div.fbChatSidebarBody');db=v.find(bc,"._51x-");fb=v.find(bc,"._51x_");jb=v.find(bc,"._5qqe");eb=l.get('www_mini_sidebar',false);var fc=v.find(bc,"._x1u");fc&&fa.render(fa.createElement(q,{className:"_3a-4 _5q85"}),fc);x.listen(window,'resize',qb);z.registerKey('q',function(event){if(ya){if(!ua)ua=v.scry(bc,'.inputsearch')[0];if(ua){ua.focus();event.prevent();}}});var gc=new s(bc);gc.subscribe('updated',qb);ib.setScrollContainer(da.byClass(ib.getRoot(),'uiScrollableAreaWrap'));ib.subscribe(['render','show','hide'],oa(function(hc){var ic=ga.getInstance(ib.getRoot());ic&&ic.adjustGripper();}));p.listen();g.subscribe('chat/option-changed',function(hc,ic){if(ic.name==='hide_groups')qb();});dc.getCore().subscribe('sidebar/typeahead/active',ac.updateOnActiveTypeahead);if(ba.SidebarClearTypeaheadGK){dc.subscribe('blur',function(){if(!ib.isVisible())ac.updateOnActiveTypeahead(null,false);});dc.subscribe('focus',function(){if(ib.isVisible()&&dc.getCore().getValue())ac.updateOnActiveTypeahead(null,true);});}dc.subscribe('reset',function(){if(!dc.getCore().getValue()&&!ib.isVisible())ac.updateOnActiveTypeahead(null,false);});g.subscribe('buddylist-nub/initialized',function(hc,ic){x.listen(ic.getButton(),'click',function(event){var jc=xa;xa=false;o.enable();var kc=ac.shouldShowSidebar()||ac.shouldShowMiniSidebar();xa=jc&&!kc;return !kc;});});wa=!!n.getSetting('sidebar_mode');ea.subscribe('privacy-user-presence-changed',qb);qb();m.init(ib);ja.addPersistentRight(ac.getVisibleWidth);ac.inform('sidebar/initialized',ac,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',ac,g.BEHAVIOR_PERSISTENT);nb=new ha(jb);nb.subscribe('resized',qb);t.addListener(function(){var hc=t.getState();if(hc.enabled){this.enable();}else this.disable();}.bind(this));},updateOnActiveTypeahead:function(bc,cc){if(!ya)return;if(cc){ib.hide();}else{kb.getView().clearContent();ib.show();qb();}},isInitialized:function(){return ab;},disable:function(){if(!ac.isEnabled())return;wa=false;xb();pb();},enable:function(){if(ac.isEnabled())return;wa=true;xb();qb();setTimeout(rb,0);},ensureLoaded:function(){if(!wa)return;if(bb)return;if(qa('pagelet_sidebar'))return;d(['UIPagelet'],function(bc){var cc=v.create('div',{id:'pagelet_sidebar'});v.appendContent(document.body,cc);bc.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});bb=true;},hide:function(){if(xa)return;xa=true;pb();},unhide:function(){if(!xa)return;xa=false;qb();},getBody:function(){return ta;},getRoot:function(){return gb;},getVisibleWidth:function(){if((!ya&&!za)||!gb)return 0;if(mb===null){mb=gb.offsetWidth;if(za)mb=206;}return mb;},isEnabled:function(){return wa;},isViewportCapable:function(){lb=w.getViewportWithoutScrollbarDimensions();var bc=l.get('sidebar.minimum_width');return lb.width>bc;},shouldShowSidebar:function(){var bc=ac.isViewportCapable();return bc&&!xa&&!yb();},isViewportCapableForMiniSidebar:function(){lb=w.getViewportWithoutScrollbarDimensions();var bc=l.get('sidebar.minimum_width'),cc=l.get('minisidebar.minimum_width');return lb.width>cc&&lb.width<=bc;},shouldShowMiniSidebar:function(){if(!eb)return false;var bc=ac.isViewportCapableForMiniSidebar();return bc&&!xa&&!yb();},isVisible:function(){return ya;},resize:qb,toggle:function(){o.toggle();},getInitTime:function(){return this._initTime;}};ka(ac,h);e.exports=ac;},null);
__d("ChatTypeaheadBehavior",["BanzaiLogger","ChatOpenTab","ChatTypeaheadEvent","CSS","MercuryConfig","MercuryTypeaheadConstants","Parent","Rect","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();function q(s,t){var u=m.byClass(s,"_4oes");if(u)j.conditionClass(u,"_5q83",t);}function r(s){"use strict";this._typeahead=s;this._loggedQuery=false;}r.prototype.enable=function(){"use strict";var s=this._typeahead;this._subscriptions=[s.subscribe('focus',function(){this._loggedQuery=false;s.getData().refreshData();q(s.getElement(),true);}.bind(this)),s.subscribe('blur',function(t){if(this._loggedQuery)g.log('ChatTypeaheadLoggerConfig',{event:i.ABANDONED_QUERY,max_results:s.getData().getMaxResults(),num_friend_results:s.getView().results.filter(function(u){return u.render_type===l.FRIEND_TYPE;}).length,query:s.getCore().value});if(!k.SidebarClearTypeaheadGK)s.getCore().reset();q(s.getElement(),false);this._loggedQuery=false;}.bind(this)),s.subscribe('respond',function(t,u){if(!this._loggedQuery&&s.getCore().getValue().length>0){g.log('ChatTypeaheadLoggerConfig',{event:i.NEW_QUERY});this._loggedQuery=true;}if(u.value&&u.value===s.getCore().getValue()){if(!u.results.length){var v=u.value.toLowerCase(),w=s.getData().getQueryCache();if(!u.isAsync&&!w.hasOwnProperty(v))return;s.getView().showNoResults();}j.addClass(s.getElement(),'hasValue');}}.bind(this)),s.subscribe('reset',function(){j.removeClass(s.getElement(),'hasValue');}),s.subscribe('select',function(t,u){var v=u.selected.uid;if(u.selected.mercury_thread&&!u.selected.mercury_thread.is_canonical)v=u.selected.mercury_thread.thread_fbid;s.getView().hide();g.log('ChatTypeaheadLoggerConfig',{event:i.RESULT_SELECTED,max_results:s.getData().getMaxResults(),result_type:u.selected.render_type});this._loggedQuery=false;h.openTabByType(v,u.selected.type,'typeahead');}.bind(this)),s.subscribe('highlight',function(t,u){if(u.index>=0){var v=s.getView().getItems()[u.index];if(v){var w=new n(v),x=v.offsetParent,y=w.boundWithin(new n(x)).getPositionVector();w.getPositionVector().sub(y).scrollElementBy(x);}}})];};r.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(s){this._typeahead.unsubscribe(s);},this);this._subscriptions=null;};o(r.prototype,{_subscriptions:null});e.exports=r;},null);
__d("PureStoreBasedStateMixin",["StoreBasedStateMixinHelper","invariant","setImmediate"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=function(){for(var k=[],l=0,m=arguments.length;l<m;l++)k.push(arguments[l]);return {getInitialState:function(){return this.constructor.calculateState();},componentWillMount:function(){h(this.constructor.calculateState);this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState());this._recalculateStateID=null;}.bind(this);this._mixin=new g(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=i(n);}.bind(this));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}.bind(this);e.exports=j;},null);
__d("formatDate",["DateConsts","DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(o,p,q){q=q||{};if(!p||!o)return '';if(typeof o==='string')o=parseInt(o,10);if(typeof o==='number')o=new Date(o*1000);j(o instanceof Date);j(!isNaN(o.getTime()));j(o.getTime()<1e+15);if(typeof p!=='string'){var r=m();for(var s in r){var t=r[s];if(t.start<=o.getTime()&&p[t.name]){p=p[t.name];break;}}}var u;if(q.skipPatternLocalization||(!q.formatInternal&&n())||p.length===1){u=p;}else{j(h.formats[p]);u=h.formats[p];}var v=q.utc?'getUTC':'get',w=o[v+'Date'](),x=o[v+'Day'](),y=o[v+'Month'](),z=o[v+'FullYear'](),aa=o[v+'Hours'](),ba=o[v+'Minutes'](),ca=o[v+'Seconds'](),da=o[v+'Milliseconds'](),ea='';for(var fa=0;fa<u.length;fa++){var ga=u.charAt(fa);switch(ga){case '\\':fa++;ea+=u.charAt(fa);break;case 'd':ea+=l(w,2);break;case 'j':ea+=w;break;case 'S':ea+=g.getOrdinalSuffix(w);break;case 'D':ea+=g.getWeekdayNameShort(x);break;case 'l':ea+=g.getWeekdayName(x);break;case 'F':case 'f':ea+=g.getMonthName(y+1);break;case 'M':ea+=g.getMonthNameShort(y+1);break;case 'm':ea+=l(y+1,2);break;case 'n':ea+=y+1;break;case 'Y':ea+=z;break;case 'y':ea+=(''+z).slice(2);break;case 'a':if(aa<12){ea+=i._("rano");}else ea+=i._("po po\u0142udniu");break;case 'A':if(aa<12){ea+=i._("rano");}else ea+=i._("Po po\u0142udniu");break;case 'g':ea+=(aa===0||aa===12)?12:aa%12;break;case 'G':ea+=aa;break;case 'h':if(aa===0||aa===12){ea+=12;}else ea+=l(aa%12,2);break;case 'H':ea+=l(aa,2);break;case 'i':ea+=l(ba,2);break;case 's':ea+=l(ca,2);break;case 'X':ea+=l(da,3);break;default:ea+=ga;}}return ea;}function l(o,p){return Array(p-(''+o).length+1).join('0')+o;}function m(){var o=new Date(),p=o.getTime(),q=o.getFullYear(),r=o.getDate()-((o.getDay()-h.weekStart+6)%7),s=new Date(q,o.getMonth()+1,0).getDate(),t=new Date(q,1,29).getMonth()===1?366:365,u=1000*60*60*24;return [{name:'today',start:o.setHours(0,0,0,0)},{name:'withinDay',start:p-u},{name:'thisWeek',start:new Date(o.getTime()).setDate(r)},{name:'withinWeek',start:p-u*7},{name:'thisMonth',start:o.setDate(1)},{name:'withinMonth',start:p-u*s},{name:'thisYear',start:o.setMonth(0)},{name:'withinYear',start:p-u*t},{name:'older',start:-Infinity}];}k.periodNames=['today','thisWeek','thisMonth','thisYear','withinDay','withinWeek','withinMonth','withinYear','older'];function n(){if(typeof window==='undefined'||!window||!window.location||!window.location.pathname)return false;var o=window.location.pathname,p='/intern';return o.substr(0,p.length)===p;}e.exports=k;},null);
__d("keyMirrorRecursive",["invariant"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(k,l){return i(k,l);}function i(k,l){var m={},n;g(j(k));for(n in k){if(!k.hasOwnProperty(n))continue;var o=k[n],p=l?l+'.'+n:n;if(j(o)){o=i(o,p);}else o=p;m[n]=o;}return m;}function j(k){return k instanceof Object&&!Array.isArray(k);}e.exports=h;},null);
__d("mergeDeepInto",["invariant","mergeHelpers"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i=h.ArrayStrategies,j=h.checkArrayStrategy,k=h.checkMergeArrayArgs,l=h.checkMergeLevel,m=h.checkMergeObjectArgs,n=h.isTerminal,o=h.normalizeMergeArg,p=function(t,u,v,w){m(t,u);l(w);var x=u?Object.keys(u):[];for(var y=0;y<x.length;y++){var z=x[y];r(t,u,z,v,w);}},q=function(t,u,v,w){k(t,u);l(w);var x=Math.max(t.length,u.length);for(var y=0;y<x;y++)r(t,u,y,v,w);},r=function(t,u,v,w,x){var y=u[v],z=u.hasOwnProperty(v),aa=z&&n(y),ba=z&&Array.isArray(y),ca=z&&!ba&&!ba,da=t[v],ea=t.hasOwnProperty(v),fa=ea&&n(da),ga=ea&&Array.isArray(da),ha=ea&&!ga&&!ga;if(fa){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else if(!z)t[v]=da;}else if(ga){if(aa){t[v]=y;}else if(ba){g(i[w]);if(w===i.Clobber)da.length=0;q(da,y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;}else if(ha){if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){p(da,y,w,x+1);}else !z;}else if(!ea)if(aa){t[v]=y;}else if(ba){t[v]=[];q(t[v],y,w,x+1);}else if(ca){t[v]={};p(t[v],y,w,x+1);}else !z;},s=function(t,u,v){var w=o(u);j(v);p(t,w,v,0);};e.exports=s;},null);
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;},null);
__d("MercuryLocalIDs",["PresenceUtil","randomInt"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i={generateMessageID:function(k){var l=k||Date.now(),m=h(0,4294967295),n=g.getSessionID();return ("<"+l+":"+m+"-"+n+"@mail.projektitan.com>");},generateThreadID:function(k){return 'root:'+i.generateMessageID(k);},generateOfflineThreadingID:function(k){var l=k||Date.now(),m=h(0,4294967295),n=('0000000000000000000000'+m.toString(2)).slice(-22),o=l.toString(2)+n;return j(o);}};function j(k){var l='';while(k!='0'){var m=0,n='';for(var o=0;o<k.length;o++){m=2*m+parseInt(k[o],10);if(m>=10){n+='1';m-=10;}else n+='0';}l=m.toString()+l;k=n.slice(n.indexOf('1'));}return l;}e.exports=i;},null);
__d("MercuryMessageObject",["MercuryActionStatus","MercuryActionType","MercuryIDs","MercuryLocalIDs","MercuryMessageClientState","MercuryMessageSourceTags","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercurySendMessageFields","fbt","formatDate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();function s(v){"use strict";this.$MercuryMessageObject0=v;}s.prototype.constructUserGeneratedMessageObject=function(v,w,x,y,z){"use strict";var aa=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);if(typeof v=='string')v=v.replace(/^\s+/,'').replace(/\s+$/,'');aa.body=v;aa.has_attachment=false;aa.html_body=false;aa.attachments=[];aa.specific_to_list=y||[];aa.creator_info=z;return aa;};s.prototype.constructStickerMessageObject=function(v,w,x){"use strict";var y=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,w,x);y.has_attachment=true;y.html_body=false;y.attachments=[];y.sticker_id=v;y.specific_to_list=[];return y;};s.prototype.constructAttachmentMessageObject=function(v,w){"use strict";var x=t(this.$MercuryMessageObject0,h.USER_GENERATED_MESSAGE,v,w);x.attachments=[];x.specific_to_list=[];return x;};s.prototype.constructLogMessageObject=function(v,w,x,y){"use strict";var z=t(this.$MercuryMessageObject0,h.LOG_MESSAGE,v,w);z.log_message_type=x;z.log_message_data=y;return z;};s.prototype.normalizeNewMessage=function(v){"use strict";if(v.status===undefined)v.status=g.UNSENT;v.timestamp_absolute=q._("Dzisiaj");v.message_id=v.message_id||j.generateMessageID(v.timestamp);var w=i.getParticipantIDFromUserID(this.$MercuryMessageObject0);v.specific_to_list=v.specific_to_list||[];if(v.specific_to_list.length&&v.specific_to_list.indexOf(w)===-1)v.specific_to_list.push(w);if(!v.thread_id){if(v.specific_to_list.length==1){v.thread_id='user:'+this.$MercuryMessageObject0;}else if(v.specific_to_list.length==2){var x=v.specific_to_list[0]==w?v.specific_to_list[1]:v.specific_to_list[0];v.thread_id=i.getThreadIDFromParticipantID(x);}v.thread_id=v.thread_id||'root:'+v.message_id;}if(!v.specific_to_list.length){var y=i.tokenize(v.thread_id),z=y.type,aa=y.value;if(z=='user')v.specific_to_list=['fbid:'+aa,w];}if(!v[p.MANUAL_RETRY_CNT])v[p.MANUAL_RETRY_CNT]=0;};s.prototype.normalizeResendMessage=function(v){"use strict";v.status=g.RESENDING;v.timestamp=Date.now();v[p.MANUAL_RETRY_CNT]+=1;};s.prototype.normalizeAddAttachmentPlaceholder=function(v,w,x){"use strict";if(x.preview_attachments.length>0){v.has_attachment=true;v.preview_attachments=x.preview_attachments;}v.client_state=k.DO_NOT_SEND_TO_SERVER;v.status=g.RESENDING;v.upload_id=w;};function t(v,w,x,y){var z=u(x)?[l.CHAT]:[],aa=Date.now(),ba=r(new Date(aa),'g:ia'),ca={action_type:w,thread_id:y,author:i.getParticipantIDFromUserID(v),author_email:null,coordinates:null,timestamp:aa,timestamp_absolute:(new Date(aa)).toLocaleDateString(),timestamp_relative:ba,timestamp_time_passed:o.TODAY,is_unread:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:x,source_tags:z};return ca;}function u(v){switch(v){case n.CHAT_WEB:case n.CHAT_JABBER:case n.CHAT_IPHONE:case n.CHAT_MEEBO:case n.CHAT_ORCA:case n.CHAT_TEST:case n.CHAT:case n.DESKTOP:return true;default:return false;}}Object.assign(s,m);e.exports=s;},null);
__d("MercuryMessageActions",["MercuryActionType","MercuryMessageObject","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();'use strict';function l(m){this.$MercuryMessageActions0=m;this.$MercuryMessageActions1=h.getForFBID(this.$MercuryMessageActions0);this.$MercuryMessageActions2=j.getForFBID(this.$MercuryMessageActions0);}l.prototype.send=function(m,n,o){n=n||Function.prototype;this.$MercuryMessageActions1.normalizeNewMessage(m);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},m),i.CLIENT_SEND_MESSAGE));this.$MercuryMessageActions2.sendNewMessage(m,o);n(m.thread_id);};l.prototype.resend=function(m,n){var o=Object.assign({},m);this.$MercuryMessageActions1.normalizeResendMessage(o);this.send(o,(void 0),n);};l.prototype.addAttachmentPlaceholder=function(m,n,o){this.$MercuryMessageActions1.normalizeAddAttachmentPlaceholder(m,n,o);this.$MercuryMessageActions1.normalizeNewMessage(m);this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3(Object.assign({},m),i.CLIENT_SEND_MESSAGE));};l.prototype.cancelAttachmentPlaceholder=function(m,n){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:m,upload_data:n,action_type:g.CANCEL_ATTACHMENT_PLACEHOLDER},i.CLIENT_SEND_MESSAGE));};l.prototype.confirmAttachmentPlaceholder=function(m,n){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions3({upload_id:m,upload_data:n,action_type:g.CONFIRM_ATTACHMENT_PLACEHOLDER},i.CLIENT_SEND_MESSAGE));};l.prototype.markSpam=function(m,n){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4(m,n,g.MARK_MESSAGES_SPAM,i.CLIENT_MARK_MESSAGES_SPAM));};l.prototype["delete"]=function(m,n,o){this.$MercuryMessageActions2.handleUpdate(this.$MercuryMessageActions4(m,n,g.DELETE_MESSAGES,o||i.CLIENT_DELETE_MESSAGES));};l.prototype.$MercuryMessageActions3=function(m,n){return {actions:[m],from_client:true,payload_source:n};};l.prototype.$MercuryMessageActions5=function(m,n){return {actions:[m],from_client:false,payload_source:n};};l.prototype.$MercuryMessageActions4=function(m,n,o,p){return {actions:[{action_type:o,action_id:null,thread_id:m,message_ids:n}],from_client:true,payload_source:p};};Object.assign(l,k);e.exports=l;},null);
__d("MercuryThreadActions",["MercuryActionType","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MessagingTag","merge"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';function m(n){this.$MercuryThreadActions0=n;this.__serverRequests=i.getForFBID(this.$MercuryThreadActions0);}m.prototype.markRead=function(n,o){this.batchMarkRead([n],o);};m.prototype.batchMarkRead=function(n,o){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(n,true,o));};m.prototype.markUnread=function(n,o){this.batchMarkUnread([n],o);};m.prototype.batchMarkUnread=function(n,o){this.__serverRequests.handleUpdate(this.$MercuryThreadActions1(n,false,o));};m.prototype.markSeen=function(n,o){this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.MARK_THREAD_SEEN,h.CLIENT_MARK_THREAD_SEEN,{persistent:o}));};m.prototype.archive=function(n,o){this.batchArchive([n],o);};m.prototype.batchArchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,true,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(n,true));};m.prototype.unarchive=function(n,o){this.batchUnarchive([n],o);};m.prototype.batchUnarchive=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadArchivedStatus(p,false,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions2(n,false));};m.prototype.markSpam=function(n,o){this.batchMarkSpam([n],o);};m.prototype.batchMarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.markThreadSpam(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,k.SPAM));};m.prototype.unmarkSpam=function(n,o){this.batchUnmarkSpam([n],o);};m.prototype.batchUnmarkSpam=function(n,o){n.forEach(function(p){this.__serverRequests.unmarkThreadSpam(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,k.INBOX));};m.prototype.changeFolder=function(n,o){this.batchChangeFolder([n],o);};m.prototype.batchChangeFolder=function(n,o){n.forEach(function(p){this.__serverRequests.changeThreadFolder(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.$MercuryThreadActions3(n,o));};m.prototype["delete"]=function(n,o){this.batchDelete([n],o);};m.prototype.batchDelete=function(n,o){n.forEach(function(p){this.__serverRequests.deleteThread(p,o);}.bind(this));this.__serverRequests.handleUpdate(this.__constructClientPayload(n,g.DELETE_THREAD,h.CLIENT_DELETE_THREAD));};m.prototype.unmute=function(n){this.updateMuteSetting(n,0);};m.prototype.updateMuteSetting=function(n,o){this.__serverRequests.changeMutingOnThread(n,o);this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.CHANGE_MUTE_SETTINGS,h.CLIENT_CHANGE_MUTE_SETTINGS,{mute_settings:o}));};m.prototype.addParticipants=function(n,o){this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.ADD_PARTICIPANTS,h.CLIENT_ADD_PARTICIPANTS,{participants:o}));};m.prototype.unpinThread=function(n){this.__serverRequests.unpinThread(n);this.__serverRequests.handleUpdate(this.__constructClientPayload([n],g.UNPIN_THREAD,h.CLIENT_UNPIN_THREAD));};m.prototype.$MercuryThreadActions1=function(n,o,p){return this.__constructClientPayload(n,g.CHANGE_READ_STATUS,h.CLIENT_CHANGE_READ_STATUS,{mark_as_read:o,source:p});};m.prototype.$MercuryThreadActions2=function(n,o){return this.__constructClientPayload(n,g.CHANGE_ARCHIVED_STATUS,h.CLIENT_CHANGE_ARCHIVED_STATUS,{archived:o});};m.prototype.$MercuryThreadActions3=function(n,o){return this.__constructClientPayload(n,g.CHANGE_FOLDER,h.CLIENT_CHANGE_FOLDER,{new_folder:o});};m.prototype.__constructClientPayload=function(n,o,p,q){return {actions:n.map(function(r){return l({action_type:o,action_id:null,thread_id:r},q);}),from_client:true,payload_source:p};};Object.assign(m,j);e.exports=m;},null);
__d("FBRTCCallSummary",["FBRTCConstants","FBRTCIceStatsParser","FBRTCLogger","UserAgentData","copyProperties","performanceNow"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m=5*60*1000,n={CALL_STARTED:'started',POPUP_OPENED:'opened',SENT_OFFER:'s_o',RECV_OFFER:'r_o',SENT_OFFER_ACK:'s_oack',RECV_OFFER_ACK:'r_oack',SENT_RETRIED_OFFER:'s_o2',RECV_RETRIED_OFFER:'r_o2',SENT_RETRIED_OFFER_ACK:'s_oack2',RECV_RETRIED_OFFER_ACK:'r_oack2',SENT_PRANSWER:'s_pr',RECV_PRANSWER:'r_pr',NETWORK_READY:'network_ready',SENT_ANSWER:'s_a',RECV_ANSWER:'r_a',SENT_ANSWER_ACK:'s_aack',RECV_ANSWER_ACK:'r_aack',SENT_RETRIED_ANSWER:'s_a2',RECV_RETRIED_ANSWER:'r_a2',SENT_RETRIED_ANSWER_ACK:'s_aack2',RECV_RETRIED_ANSWER_ACK:'r_aack2',SENT_OK:'s_ok',RECV_OK:'r_ok',CALL_CONNECTED:'connected',CALL_ENDED:'ended'};o.CURRENT_SUMMARY_VERSION=10;function o(p){"use strict";this.peerID=p.peerID;this.callID=p.callID;this.$FBRTCCallSummary0=p.isCaller;this.$FBRTCCallSummary1=(new Date()).valueOf();this.$FBRTCCallSummary2=null;this.$FBRTCCallSummary3={};this.$FBRTCCallSummary4=null;this.$FBRTCCallSummary5=null;this.$FBRTCCallSummary6=null;this.$FBRTCCallSummary7=null;this.$FBRTCCallSummary8=null;this.$FBRTCCallSummary9=null;this.$FBRTCCallSummarya={};this.$FBRTCCallSummaryb={};this.$FBRTCCallSummaryc={};this.$FBRTCCallSummaryd={};this.$FBRTCCallSummarye={};this.$FBRTCCallSummaryf={};this.$FBRTCCallSummaryg=l();this.$FBRTCCallSummaryh=0;this.$FBRTCCallSummaryi={};this.$FBRTCCallSummaryj=this.$FBRTCCallSummaryg;this.$FBRTCCallSummaryk=0;this.$FBRTCCallSummaryl={};this.addExtraInfo(i.Key.DEVICE_INFO,this.$FBRTCCallSummarym());this.$FBRTCCallSummaryn();this.$FBRTCCallSummaryo=h.getInstance();this.$FBRTCCallSummaryp=i.getInstance();}o.prototype.toJsonString=function(){"use strict";this.$FBRTCCallSummary8=(new Date()).valueOf();return JSON.stringify({version:o.CURRENT_SUMMARY_VERSION,peerID:this.peerID,callID:this.callID,isCaller:this.$FBRTCCallSummary0,startTime:this.$FBRTCCallSummary1,trigger:this.$FBRTCCallSummary2,signalingTime:this.$FBRTCCallSummary3,endCallReason:this.$FBRTCCallSummary4,endCallSubreason:this.$FBRTCCallSummary5,isRemoteEnded:this.$FBRTCCallSummary6,lastUpdatedTime:this.$FBRTCCallSummary7,lastSerializedTime:this.$FBRTCCallSummary8,unsetOnRetrieve:this.$FBRTCCallSummary9,openCount:this.$FBRTCCallSummaryk,extraInfo:this.$FBRTCCallSummaryl,pcStats:this.$FBRTCCallSummarya,captureStats:this.$FBRTCCallSummaryb,gen0IceSentCount:this.$FBRTCCallSummaryc,gen0IceReceivedCount:this.$FBRTCCallSummaryd,iceSentCount:this.$FBRTCCallSummarye,iceReceivedCount:this.$FBRTCCallSummaryf,newSignalingTime:this.$FBRTCCallSummaryi,accumulatedCallTime:this.$FBRTCCallSummaryq()});};o.fromJsonString=function(p){"use strict";var q;try{q=JSON.parse(p);}catch(r){return null;}if(q.version!==o.CURRENT_SUMMARY_VERSION)return null;if(!q.hasOwnProperty('peerID')||!q.hasOwnProperty('callID')||!q.hasOwnProperty('isCaller')||!q.hasOwnProperty('startTime')||!q.hasOwnProperty('trigger')||!q.hasOwnProperty('signalingTime')||!q.hasOwnProperty('endCallReason')||!q.hasOwnProperty('isRemoteEnded')||!q.hasOwnProperty('lastUpdatedTime')||!q.hasOwnProperty('lastSerializedTime'))return null;var s=new o({peerID:q.peerID,callID:q.callID,isCaller:q.isCaller});s.$FBRTCCallSummary1=q.startTime;s.$FBRTCCallSummary2=q.trigger;s.$FBRTCCallSummary3=q.signalingTime;s.$FBRTCCallSummary4=q.endCallReason;s.$FBRTCCallSummary5=q.endCallSubreason;s.$FBRTCCallSummary6=q.isRemoteEnded;s.$FBRTCCallSummary7=q.lastUpdatedTime;s.$FBRTCCallSummary8=q.lastSerializedTime;if(q.unsetOnRetrieve)s.$FBRTCCallSummary9=q.unsetOnRetrieve;if(q.openCount)s.$FBRTCCallSummaryk=q.openCount;if(q.extraInfo)s.$FBRTCCallSummaryl=q.extraInfo;if(q.pcStats)s.$FBRTCCallSummarya=q.pcStats;if(q.captureStats)s.$FBRTCCallSummaryb=q.captureStats;if(q.gen0IceSentCount)s.$FBRTCCallSummaryc=q.gen0IceSentCount;if(q.gen0IceReceivedCount)s.$FBRTCCallSummaryd=q.gen0IceReceivedCount;if(q.iceSentCount)s.$FBRTCCallSummarye=q.iceSentCount;if(q.iceReceivedCount)s.$FBRTCCallSummaryf=q.iceReceivedCount;if(q.newSignalingTime)s.$FBRTCCallSummaryi=q.newSignalingTime;if(q.accumulatedCallTime)s.$FBRTCCallSummaryh=q.accumulatedCallTime;return s;};o.restoreOrInitialize=function(p,q,r,s,t){"use strict";var u=p.retrieveCallSummary(q,r);if(!u){u=new o({peerID:q,callID:r,isCaller:s});if(t){u.onFullMessageReceived({msg:t});u.onOfferAckSent(t);}else u.onCallStarted(i.Trigger.UNKNOWN);i.getInstance().logError(q,r,'Missing call summary from storage');}else if(u.$FBRTCCallSummary9){u.$FBRTCCallSummary4=null;u.$FBRTCCallSummary5=null;u.$FBRTCCallSummary6=null;delete u.$FBRTCCallSummary3[n.CALL_ENDED];delete u.$FBRTCCallSummaryi[n.CALL_ENDED];u.$FBRTCCallSummary9=null;}return u;};o.logSavedSummaries=function(p){"use strict";var q=p.getLoggableSummaries(),r=q.length;if(r<=0)return;var s=i.getInstance(),t=[];for(var u=0;u<r;u++){var v=q[u];s.logEndCallSummary(v);t.push({peerID:v.peerID,callID:v.callID});}p.removeCallSummaries(t);s.logToConsole('Logged pending summaries: '+r);};o.prototype.save=function(p){"use strict";var q=l(),r=q-this.$FBRTCCallSummaryj;if(r>m){this.$FBRTCCallSummaryp.logInfo(this.peerID,this.callID,'Summary too old: '+r);return;}p.storeCallSummary(this.peerID,this.callID,this);this.$FBRTCCallSummaryj=q;};o.prototype.getLastUpdatedTime=function(){"use strict";return this.$FBRTCCallSummary7;};o.prototype.setLastUpdatedTime=function(p){"use strict";this.$FBRTCCallSummary7=p;};o.prototype.getExtraInfo=function(){"use strict";return this.$FBRTCCallSummaryl;};o.prototype.addExtraInfo=function(p,q){"use strict";this.$FBRTCCallSummaryl[p]=q;this.$FBRTCCallSummaryn();};o.prototype.onCallStarted=function(p){"use strict";this.$FBRTCCallSummary2=p;this.$FBRTCCallSummaryr(n.CALL_STARTED);this.$FBRTCCallSummaryn();};o.prototype.onPopupOpened=function(){"use strict";this.$FBRTCCallSummaryr(n.POPUP_OPENED);this.$FBRTCCallSummaryk++;this.$FBRTCCallSummaryn();};o.prototype.setPcStats=function(p){"use strict";this.$FBRTCCallSummarya=p;this.$FBRTCCallSummaryn();};o.prototype.setVideoCaptureStats=function(p,q){"use strict";this.$FBRTCCallSummaryb={w:p,h:q};this.$FBRTCCallSummaryn();};o.prototype.onOfferAckSent=function(p){"use strict";this.onMessageSent({type:g.PayloadType.OFFER_ACK,flag:p.flag});};o.prototype.onMessageSent=function(p){"use strict";var q=p.flag===1;switch(p.type){case g.PayloadType.OFFER:this.$FBRTCCallSummarys(q,n.SENT_OFFER,n.SENT_RETRIED_OFFER);this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummarys(q,n.SENT_ANSWER,n.SENT_RETRIED_ANSWER);this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;case g.PayloadType.OK:this.$FBRTCCallSummaryr(n.SENT_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryr(n.SENT_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummarys(q,n.SENT_OFFER_ACK,n.SENT_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummarys(q,n.SENT_ANSWER_ACK,n.SENT_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryt(p,this.$FBRTCCallSummaryc,this.$FBRTCCallSummarye);break;default:}this.$FBRTCCallSummaryn();};o.prototype.$FBRTCCallSummaryt=function(p,q,r){"use strict";var s=null,t=null,u=this.$FBRTCCallSummaryo.extractIceInfo(p.sdp);for(var v=0;v<u.length;v++){s=u[v].gen;t=u[v].type;if(s===0)this.$FBRTCCallSummaryu(q,t);this.$FBRTCCallSummaryu(r,t);}};o.prototype.$FBRTCCallSummaryu=function(p,q){"use strict";if(!p[q]){p[q]=1;}else p[q]=p[q]+1;};o.prototype.$FBRTCCallSummaryv=function(p){"use strict";if(p.isFromMobile())this.addExtraInfo(i.Key.PEER_IS_MOBILE,'1');};o.prototype.onFullMessageReceived=function(p){"use strict";var q=p.msg,r=q.flag===1;switch(q.type){case g.PayloadType.OFFER:this.$FBRTCCallSummaryv(p);this.$FBRTCCallSummarys(r,n.RECV_OFFER,n.RECV_RETRIED_OFFER);this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.ANSWER:this.$FBRTCCallSummaryv(p);this.$FBRTCCallSummarys(r,n.RECV_ANSWER,n.RECV_RETRIED_ANSWER);this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;case g.PayloadType.OK:this.$FBRTCCallSummaryr(n.RECV_OK);break;case g.PayloadType.PRANSWER:this.$FBRTCCallSummaryr(n.RECV_PRANSWER);break;case g.PayloadType.OFFER_ACK:this.$FBRTCCallSummarys(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);break;case g.PayloadType.ANSWER_ACK:this.$FBRTCCallSummarys(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);break;case g.PayloadType.ICE_CANDIDATE:this.$FBRTCCallSummaryt(q,this.$FBRTCCallSummaryd,this.$FBRTCCallSummaryf);break;default:}this.$FBRTCCallSummaryn();};o.prototype.onMsgAckReceived=function(p,q){"use strict";var r=p.msg.flag===1;if(q){this.$FBRTCCallSummarys(r,n.RECV_OFFER_ACK,n.RECV_RETRIED_OFFER_ACK);}else this.$FBRTCCallSummarys(r,n.RECV_ANSWER_ACK,n.RECV_RETRIED_ANSWER_ACK);};o.prototype.onCallConnected=function(){"use strict";this.$FBRTCCallSummaryr(n.NETWORK_READY);this.$FBRTCCallSummaryr(n.CALL_CONNECTED);this.$FBRTCCallSummaryn();};o.prototype.onCallEnded=function(p,q,r,s){"use strict";this.$FBRTCCallSummary9=r;this.$FBRTCCallSummary4=p;this.$FBRTCCallSummary5=s;this.$FBRTCCallSummary6=q;this.$FBRTCCallSummaryr(n.CALL_ENDED);this.$FBRTCCallSummaryn();};o.prototype.toString=function(){"use strict";var p={};p.core_metrics=this.$FBRTCCallSummaryw();p.time_series=null;return JSON.stringify(p);};o.prototype.$FBRTCCallSummaryw=function(){"use strict";var p={};p.ver=o.CURRENT_SUMMARY_VERSION;p.caller=this.$FBRTCCallSummary0;p.conn=this.$FBRTCCallSummaryx();p.peer_id=this.peerID;p.has_video=true;p.open_count=this.$FBRTCCallSummaryk;p.signaling=this.$FBRTCCallSummaryy();p.sender=this.$FBRTCCallSummaryz();p.receiver=this.$FBRTCCallSummaryA();p.end=this.$FBRTCCallSummaryB();p.video=this.$FBRTCCallSummaryC();return p;};o.prototype.$FBRTCCallSummaryx=function(){"use strict";var p={dtls:1};if(this.$FBRTCCallSummarya.sender&&this.$FBRTCCallSummarya.sender.rtt)p.rtt=this.$FBRTCCallSummarya.sender.rtt;return p;};o.prototype.$FBRTCCallSummaryy=function(){"use strict";var p={};if(this.$FBRTCCallSummary2)p.trigger=this.$FBRTCCallSummary2;p.start_time=this.$FBRTCCallSummary1;p.time_from_start=this.$FBRTCCallSummary3;var q=this.$FBRTCCallSummary3[n.CALL_CONNECTED],r=this.$FBRTCCallSummary3[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummary8){r=this.$FBRTCCallSummary8-this.$FBRTCCallSummary1;}else r=this.$FBRTCCallSummaryD();var s=r-q;if(s>0)p.duration=s;}p.new_time_from_start=this.$FBRTCCallSummaryi;q=this.$FBRTCCallSummaryi[n.CALL_CONNECTED];r=this.$FBRTCCallSummaryi[n.CALL_ENDED];if(q){if(!r)if(this.$FBRTCCallSummaryh>0){r=this.$FBRTCCallSummaryh;}else r=this.$FBRTCCallSummaryq();s=r-q;if(s>0)p.new_duration=s;}return p;};o.prototype.$FBRTCCallSummaryz=function(){"use strict";var p={};if(this.$FBRTCCallSummaryc)p.ice_g0=this.$FBRTCCallSummaryc;if(this.$FBRTCCallSummarye)p.ice=this.$FBRTCCallSummarye;if(this.$FBRTCCallSummarya.sender)k(p,this.$FBRTCCallSummarya.sender);return p;};o.prototype.$FBRTCCallSummaryA=function(){"use strict";var p={};if(this.$FBRTCCallSummaryd)p.ice_g0=this.$FBRTCCallSummaryd;if(this.$FBRTCCallSummaryf)p.ice=this.$FBRTCCallSummaryf;return p;};o.prototype.$FBRTCCallSummaryB=function(){"use strict";var p={};if(this.$FBRTCCallSummary4!==null){p.end_call_reason_string=g.callEndReasonString(this.$FBRTCCallSummary4);if(this.$FBRTCCallSummary5!==null)p.end_call_subreason_string=this.$FBRTCCallSummary5;p.remote_ended=this.$FBRTCCallSummary6;}if(this.$FBRTCCallSummarya.end)k(p,this.$FBRTCCallSummarya.end);return p;};o.prototype.$FBRTCCallSummaryC=function(){"use strict";var p={capture:{}};if(this.$FBRTCCallSummarya.video&&this.$FBRTCCallSummarya.video.sender)k(p,this.$FBRTCCallSummarya.video.sender);if(this.$FBRTCCallSummaryb)k(p.capture,this.$FBRTCCallSummaryb);return {sender:p};};o.prototype.$FBRTCCallSummaryD=function(){"use strict";return (new Date()).valueOf()-this.$FBRTCCallSummary1;};o.prototype.$FBRTCCallSummaryq=function(){"use strict";var p=l()-this.$FBRTCCallSummaryg;return Math.floor(this.$FBRTCCallSummaryh+p);};o.prototype.$FBRTCCallSummaryr=function(p){"use strict";if(this.$FBRTCCallSummary3[p])return;this.$FBRTCCallSummary3[p]=this.$FBRTCCallSummaryD();this.$FBRTCCallSummaryi[p]=this.$FBRTCCallSummaryq();};o.prototype.$FBRTCCallSummarys=function(p,q,r){"use strict";if(p){this.$FBRTCCallSummaryr(r);}else this.$FBRTCCallSummaryr(q);};o.prototype.$FBRTCCallSummaryn=function(){"use strict";this.$FBRTCCallSummary7=(new Date()).valueOf();};o.prototype.$FBRTCCallSummarym=function(){"use strict";return {device:j.deviceName,os:j.platformName,os_version:j.platformFullVersion,browser:j.browserName,browser_version:j.browserFullVersion,screen_height:window.screen.availHeight,screen_width:window.screen.availWidth};};e.exports=o;},null);
__d("ChatAppLoader",["Bootloader"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();'use strict';function h(j){g.loadModules(["ChatApp"],j);}var i={unhide:function(){h(function(j){j.unhide&&j.unhide();});},hide:function(){h(function(j){j.hide&&j.hide();});},init:function(j,k,l){h(function(m){m.init&&m.init(j,k,l);});}};e.exports=i;},null);
__d("MercuryMessages",["BanzaiODS","EventEmitter","ImmutableObject","LogHistory","Map","MercuryActionStatus","MercuryActionType","MercuryAssert","MercuryLogMessageType","MercuryMessageClientState","MercuryPayloadSource","MercurySingletonMixin","MercuryMessageActions","MercuryMessageIDs","RangedCallbackManager","MercurySendMessageFields","MercuryServerRequests","MercuryThreadActions","MercuryThreadInformer","MercuryThreads","URI","copyProperties","invariant","isMessengerDotComURI","mergeDeep"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea){b.__markCompiled&&b.__markCompiled();'use strict';var fa=new h(),ga=j.getInstance('mercury_messages');function ha(qa,ra){var sa=ra;if(qa._localIdsMap[ra])sa=qa._localIdsMap[ra];return qa._messages.get(sa);}function ia(qa){switch(qa){case q.UNKNOWN:case q.SERVER_INITIAL_DATA:case q.SERVER_FETCH_THREAD_INFO:case q.SERVER_THREAD_SYNC:return true;}return false;}function ja(qa,ra){if(!qa._threadsToMessages[ra])qa._threadsToMessages[ra]=new u(function(sa){return ha(qa,sa).timestamp;},function(sa,ta){return ta-sa;});return qa._threadsToMessages[ra];}function ka(qa,ra,sa){ra.forEach(function(ta){var ua=ja(qa,ta);ua.setReachedEndOfArray();qa._emitReorderedChange(ta,sa);});}function la(qa){this._fbid=qa;this._messageActions=s.getForFBID(this._fbid);this._serverRequests=w.getForFBID(this._fbid);this._threadInformer=y.getForFBID(this._fbid);this._threads=z.getForFBID(this._fbid);this._threadActions=x.getForFBID(this._fbid);this._didChange=false;this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(ra,sa){var ta=(sa.actions||[]).filter(function(va){var wa=va.action_type,xa=((va.is_forward||va.thread_id)&&(wa==m.LOG_MESSAGE||wa==m.USER_GENERATED_MESSAGE||wa==m.SEND_MESSAGE||wa==m.DELETE_THREAD||wa==m.DELETE_MESSAGES||wa==m.MARK_MESSAGES_SPAM)),ya=((va.upload_id&&va.upload_data)&&(wa==m.CANCEL_ATTACHMENT_PLACEHOLDER||wa==m.CONFIRM_ATTACHMENT_PLACEHOLDER));return xa||ya;}),ua=ia(sa.payload_source);this.handleUpdates(ta,ua,sa.payload_source,sa.from_client);if(sa.end_of_history)ka(this,sa.end_of_history,sa.payload_source);if(this._didChange){this._didChange=false;fa.emit('change');}}.bind(this));ga.debug('constructed',{fbid:this._fbid});}ba(la.prototype,{getMessagesFromIDs:function(qa){return (qa||[]).map(ha.bind(null,this)).filter(function(ra){return ra;});},hasLoadedNMessages:function(qa,ra){var sa=ja(this,qa);return sa.hasReachedEndOfArray()||sa.getCurrentArraySize()>=ra;},hasLoadedExactlyNMessages:function(qa,ra){var sa=ja(this,qa);return sa.getCurrentArraySize()==ra;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._localTitanMessagesCount={};this._messages=new k();this._localIdsMap={};},getThreadMessagesRange:function(qa,ra,sa,ta,ua,va){var wa=ja(this,qa),xa=function(hb){ta(ma(this,hb));}.bind(this),ya=wa.executeOrEnqueue(ra,sa,xa),za=wa.getUnavailableResources(ya),ab=this._failedHistoryFetchThreads[qa];if(za.length&&!ab){var bb=wa.getCurrentArraySize(),cb=this._localTitanMessagesCount[qa]||0,db=bb-cb,eb=za.length+cb,fb=this.getCurrentlyLoadedMessages(qa),gb=fb.length?fb[0].timestamp:0;ga.debug('fetch_missing_messages',{threadID:qa,offset:ra,limit:sa,timestamp:gb,missingIndices:za,messageCount:bb,localMessageCount:cb});this._serverRequests.fetchThreadMessages(qa,db,eb,gb,ua,va);}else this._failedHistoryFetchThreads[qa]=false;return ya;},getThreadMessagesRangeNow:function(qa,ra,sa){var ta=ja(this,qa),ua=[];for(var va=ra;va<ra+sa;va++){var wa=ta.getResourceAtIndex(va),xa=ha(this,wa);xa&&ua.push(xa);}return ua;},getThreadMessagesSinceTimestamp:function(qa,ra){var sa=ja(this,qa),ta=sa.getElementsUntil(ra);return ma(this,ta);},hasLoadedAllMessages:function(qa){return ja(this,qa).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(qa){var ra=ja(this,qa).getAllResources();return ma(this,ra);},unsubscribe:function(qa,ra){n.isThreadID(ra);var sa=ja(this,ra);sa.unsubscribe(qa);},_addNewMessage:function(qa,ra){pa(ra);this._messages.set(qa,new i(ra));},_updateMessage:function(qa,ra,sa){var ta=i.set(ra,sa);this._messages.set(qa,ta);return ta;},_shouldSortOutOfOrderMessages:function(qa,ra,sa){if(qa==q.CLIENT_CHANNEL_MESSAGE){var ta=this.getThreadMessagesSinceTimestamp(ra,sa);if(ta.length>0){g.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},_preprocessIncomingAction:function(qa,ra){var sa=qa.action_type;if(ra==q.CLIENT_CHANNEL_MESSAGE&&sa==m.USER_GENERATED_MESSAGE&&qa.threading_id&&this._localIdsMap[qa.threading_id]===qa.threading_id){qa.client_message_id=qa.threading_id;qa.status=l.SUCCESS;qa.action_type=m.SEND_MESSAGE;sa=qa.action_type;}if(ra===q.CLIENT_CHANNEL_MESSAGE&&sa==m.USER_GENERATED_MESSAGE){var ta=this._threads.getThreadMetaNow(qa.thread_id);if(ta&&ta.folder)qa.folder=ta.folder;}return qa;},handleUpdates:function(qa,ra,sa,ta){var ua,va={},wa={};for(var xa=0;xa<qa.length;xa++){var ya=this._preprocessIncomingAction(qa[xa],sa),za=ya.action_type,ab=ha(this,ya.message_id);if(ya.is_forward||sa==q.SERVER_SEARCH){if(!this._messages.has(ya.message_id))this._addNewMessage(ya.message_id,ya);continue;}else if(ya.client_state===p.SEND_TO_SERVER){this._addNewMessage(ya.message_id,ya);continue;}else if(za==m.SEND_MESSAGE){var bb=ya.client_message_id;if(bb&&this._localIdsMap[bb]&&ya.status){var cb=ha(this,bb),db=cb.status;if(cb.status==l.SUCCESS)continue;if(ya.status==l.UNCONFIRMED){if(!wa[ya.thread_id])wa[ya.thread_id]=[];wa[ya.thread_id].push(bb);}else if(!va[ya.thread_id])va[ya.thread_id]=[];this._updateLocalMessage(ya);if(typeof db!==(void 0)||ya.status==l.FAILED_UNKNOWN_REASON||ya.status==l.UNABLE_TO_CONFIRM||ya.status==l.SUCCESS||ya.status==l.ERROR)this._emitUpdatedChange(ya.thread_id,ha(this,bb).message_id,sa);}continue;}else if(za==m.DELETE_THREAD){ja(this,ya.thread_id).removeAllResources();continue;}else if(za==m.DELETE_MESSAGES){this._deleteMessages(ya.thread_id,ya.message_ids,sa);continue;}else if(za===m.MARK_MESSAGES_SPAM){this._markMessagesSpam(ya,sa);continue;}else if((ya.threading_id&&this._localIdsMap[ya.threading_id])||(ab&&!ab.is_forward)){if(ab&&ya.ranges&&ya.ranges.length>0){var eb=ab.message_id;this._updateMessage(this._localIdsMap[eb]||eb,ab,{ranges:qa.ranges});this._emitUpdatedChange(ab.thread_id,ab.message_id,'link_shim');}continue;}else if(za===m.CONFIRM_ATTACHMENT_PLACEHOLDER){this._confirmAttachmentPlaceholder(ya.upload_id,ya.upload_data);continue;}else if(za===m.CANCEL_ATTACHMENT_PLACEHOLDER){this._cancelAttachmentPlaceholder(ya.upload_id,ya.upload_data);continue;}else{if(sa===q.CLIENT_SEND_MESSAGE){this._localIdsMap[ya.message_id]=ya.message_id;if(ya.thread_id=='root:'+ya.message_id)ja(this,ya.thread_id).setReachedEndOfArray();}if(za==m.LOG_MESSAGE&&ya.log_message_type==o.SERVER_ERROR)this._failedHistoryFetchThreads[ya.thread_id]=true;if(ya.client_state===p.DO_NOT_SEND_TO_SERVER&&ya.upload_id)this._uploadMessages[ya.upload_id]=ya;if(!va[ya.thread_id])va[ya.thread_id]=[];va[ya.thread_id].push(ya.message_id);this._addNewMessage(ya.message_id,ya);if(ya.threading_id&&ya.threading_id!=ya.message_id)t.addServerID(ya.threading_id,ya.message_id);if(ya[v.MANUAL_RETRY_CNT]>0){ua=ja(this,ya.thread_id);ua.resortResources([ya.message_id]);this._emitReorderedChange(ya.thread_id,q.CLIENT_SEND_MESSAGE);}ra=ra||this._shouldSortOutOfOrderMessages(sa,ya.thread_id,ya.timestamp);if(!ra)this._emitReceivedChange(ha(this,ya.message_id));continue;}}for(var fb in va){ua=ja(this,fb);var gb=ua.getAllResources(),hb=gb.filter(function(jb){var kb=this._messages.get(jb);return kb.action_type==m.LOG_MESSAGE&&kb.log_message_type==o.SERVER_ERROR;}.bind(this));ua.removeResources(hb);if(ta)na(this,fb,va[fb]);if(ra){ua.addResources(va[fb]);this._emitReorderedChange(fb,sa);}else ua.addResourcesWithoutSorting(va[fb].reverse(),0);this._threadInformer.updatedThread(fb);}var ib=Object.keys(wa);if(ib.length)this._serverRequests.requestMessageConfirmation(wa);this._didChange&&ga.debug('handle_updates',{localMessageCounts:ea(this._localTitanMessagesCount)});},isFirstMessage:function(qa){var ra=ja(this,qa.thread_id);if(ra.getCurrentArraySize()===0)return false;var sa=ra.getResourceAtIndex(ra.getCurrentArraySize()-1),ta=ha(this,sa).message_id,ua=ha(this,qa.message_id).message_id;return ra.hasReachedEndOfArray()&&ta==ua;},_markMessagesSpam:function(qa,ra){var sa=qa,ta=sa.thread_id,ua=sa.message_ids;if(!ua.length)return;this._deleteIndividualMessages(ta,ua,ra);this._serverRequests.markMessagesSpam(ta,ua);},_deleteMessages:function(qa,ra,sa){if(!ra.length)return;this._deleteIndividualMessages(qa,ra,sa);if(sa!==q.CLIENT_CHANNEL_MESSAGE)this._serverRequests.deleteMessages(qa,ra);},_deleteIndividualMessages:function(qa,ra,sa){var ta=ra.map(function(va){return ha(this,va).message_id;},this),ua=ja(this,qa);ua.removeResources(ta);this._emitReorderedChange(qa,sa);},_updateLocalMessage:function(qa){var ra=ha(this,qa.client_message_id),sa={};sa.status=qa.status;if(qa.status===l.SUCCESS||qa.error_data)sa.error_data=qa.error_data;var ta=qa.message_id,ua=qa.client_message_id;if(this._messages.has(ta)){this._updateMessage(ta,ra,sa);return false;}if(qa.timestamp)sa.timestamp=qa.timestamp;if(qa.log_message_data)sa.log_message_data=qa.log_message_data;if(qa.ranges&&qa.ranges.length){pa(qa);sa.ranges=qa.ranges;}if(qa.attachments&&qa.attachments.length){sa.raw_attachments=null;sa.attachments=qa.attachments;}this._localIdsMap[ua]=ta;t.addServerID(ua,ta);var va=this._updateMessage(ta,ra,sa);this._messages.set(ua,new i());if(oa(va))this._localTitanMessagesCount[va.thread_id]--;return true;},getNumberLocalMessages:function(qa){return this._localTitanMessagesCount[qa]||0;},_uploadMessages:{},_confirmAttachmentPlaceholder:function(qa,ra){var sa=this._popPendingAttachmentMessage(qa,ra);this._serverRequests.sendNewMessage(sa);},_cancelAttachmentPlaceholder:function(qa,ra){var sa=this._popPendingAttachmentMessage(qa,ra);this._deleteIndividualMessages(sa.thread_id,[sa.message_id]);if(this._localTitanMessagesCount[sa.thread_id])this._localTitanMessagesCount[sa.thread_id]--;},_popPendingAttachmentMessage:function(qa,ra){var sa=this._uploadMessages[qa];ca(sa);sa.image_ids=ra.image_ids;sa.file_ids=ra.file_ids;sa.audio_ids=ra.audio_ids;sa.gif_ids=ra.gif_ids;sa.client_state=p.SEND_TO_SERVER;delete this._uploadMessages[qa];return sa;},_emitUpdatedChange:function(qa,ra,sa){this._didChange=true;this._threadInformer.updatedMessage(qa,ra,sa);},_emitReceivedChange:function(qa){this._didChange=true;this._threadInformer.receivedMessage(qa);},_emitReorderedChange:function(qa,ra){this._didChange=true;this._threadInformer.reorderedMessages(qa,ra);}});Object.assign(la,r,{addListener:function(qa,ra){return fa.addListener(qa,ra);}});function ma(qa,ra){var sa=ra.map(ha.bind(null,qa));return sa.reverse();}function na(qa,ra,sa){var ta=sa.filter(function(ua){return oa(ha(qa,ua));});if(!qa._localTitanMessagesCount[ra])qa._localTitanMessagesCount[ra]=0;qa._localTitanMessagesCount[ra]+=ta.length;}function oa(qa){var ra=qa.action_type;if(ra==m.USER_GENERATED_MESSAGE)return true;switch(qa.log_message_type){case o.SUBSCRIBE:case o.UNSUBSCRIBE:case o.SERVER_ERROR:case o.LIVE_LISTEN:return false;default:return true;}}function pa(qa){if(!qa.ranges)return;qa.ranges.forEach(function(ra){if(!ra.entity||ra.entity.external||!ra.entity.url)return;var sa=new aa(ra.entity.url);if(da(aa.getRequestURI())&&!sa.getDomain()){sa.setProtocol('https').setDomain('www.facebook.com');ra.entity.url=sa.toString();}});}e.exports=la;},null);
__d("MercuryViewer",["CurrentUser","MercuryAssert"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';var i='fbid:'+g.getID(),j={getID:function(){return i;},isViewer:function(k){h.isParticipantID(k);return k===i;}};e.exports=j;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionType","MercuryGlobalActionType","MercuryMessages","MercuryPayloadSource","MercuryServerRequests","MercurySingletonMixin","MercuryThreadInformer","MercuryViewer","MessagingEvent","MessagingReliabilityLogger","MessagingTag","PresenceUtil","copyProperties","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=v(n);for(var x in w)if(w.hasOwnProperty(x))z[x]=w[x];var y=w===null?null:w.prototype;z.prototype=Object.create(y);z.prototype.constructor=z;z.__superConstructor__=w;function z(aa){"use strict";this.$MercuryChannelHandler0=aa;this.__serverRequests=m.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler1=o.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler2=k.getForFBID(this.$MercuryChannelHandler0);this.$MercuryChannelHandler3=[];}z.prototype.getInstanceFBID=function(){"use strict";return this.$MercuryChannelHandler0;};z.prototype.$MercuryChannelHandler4=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.message){r.addEntry('channel_receive','invalid_data');return;}var ca=ba.obj.message,da=ca.other_user_fbid?ca.other_user_fbid:ca.thread_fbid,ea={author:ca.mercury_author_id,author_email:ca.mercury_author_email,body:ca.body,subject:ca.subject,has_attachment:ca.has_attachment,attachments:ca.attachments,html_body:ca.html_body,thread_id:ca.tid,thread_fbid:ca.thread_fbid,other_user_fbid:ca.other_user_fbid,message_id:ca.mid,coordinates:ca.mercury_coordinates,is_spoof_warning:ca.is_spoof_warning,ranges:ca.ranges,source:ca.mercury_source,source_tags:ca.mercury_source_tags,threading_id:ca.threading_id,timestamp:ca.timestamp,timestamp_absolute:ca.timestamp_absolute,timestamp_relative:ca.timestamp_relative,timestamp_time_passed:ca.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ca.is_unread,is_forward:false,forward_count:ca.forward_count||ca.forward,forward_message_ids:ca.forward_msg_ids,location_text:ca.location_text,folder:ba.obj.folder};if("sync_id" in ca){ea.sync_id=ca.sync_id;}else ea.action_id=ca.action_id;var fa=[u({},ea)];fa=fa.concat(ca.forward_actions||[]);var ga=l.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdateWaitForThread({actions:fa,payload_source:ga},da);if(!ca.is_unread&&p.isViewer(ca.mercury_author_id)){var ha={};ha[da]=ba.obj.folder;this.$MercuryChannelHandler6(this.__getMessagingPayloadType(),{obj:{event:q.READ,thread_fbids:ca.thread_fbid?[ca.thread_fbid]:[],other_user_fbids:ca.other_user_fbid?[ca.other_user_fbid]:[],folder_info:ha,timestamp:ca.timestamp}});}r.addEntry('channel_receive','success',[da,ea.message_id,t.getSessionID()]);};z.prototype.$MercuryChannelHandler6=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=[],da=ba.obj.event==q.READ;(ba.obj.thread_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});(ba.obj.other_user_fbids||[]).forEach(function(ea){ca.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:ea,mark_as_read:da,timestamp:ba.obj.timestamp||0,folder:ba.obj.folder_info[ea]});});this.__serverRequests.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler7=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!(ba.obj.thread_fbids||ba.obj.other_user_fbids))return;var ca=[];(ba.obj.thread_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:da});});(ba.obj.other_user_fbids||[]).forEach(function(da){ca.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:da});});this.__serverRequests.handleUpdate({actions:ca,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler8=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids)||!ba.obj.mids)return;var ca=ba.obj.thread_fbids.length?ba.obj.thread_fbids[0]:null,da=ba.obj.other_user_fbids.length?ba.obj.other_user_fbids[0]:null,ea={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:ca,other_user_fbid:da,message_ids:ba.obj.mids};this.__serverRequests.handleUpdate({actions:[ea],threads:[ba.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.$MercuryChannelHandler9=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||!ba.obj.folder)return;var ca={action_type:j.MARK_ALL_READ,action_id:ba.obj.action_id,folder:ba.obj.folder};this.__serverRequests.handleUpdate({global_actions:[ca]});};z.prototype.$MercuryChannelHandlera=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE;(ba.obj.thread_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:da,other_user_fbid:null,archived:ba.obj.state};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);(ba.obj.other_user_fbids||[]).forEach(function(da){var ea={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:da,archived:ba.obj.state};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ca},da);},this);};z.prototype.$MercuryChannelHandlerb=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||(!ba.obj.thread_fbids&&!ba.obj.other_user_fbids))return;var ca=l.CLIENT_CHANNEL_MESSAGE,da;(ba.obj.thread_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:ea,other_user_fbid:null,new_folder:da};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);(ba.obj.other_user_fbids||[]).forEach(function(ea){if(ba.obj.event==q.TAG){da=ba.obj.tag;}else da=ba.obj.marked_as_spam?s.SPAM:s.INBOX;var fa={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:ea,thread_fbid:null,new_folder:da};this.__serverRequests.handleUpdateWaitForThread({actions:[u({},fa)],payload_source:ca},ea);},this);};z.prototype.$MercuryChannelHandlerc=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj.tag)return;switch(ba.obj.tag){case s.ACTION_ARCHIVED:this.$MercuryChannelHandlera(aa,ba);break;case s.INBOX:case s.OTHER:this.$MercuryChannelHandlerb(aa,ba);break;}};z.prototype.__markAsSeen=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlerd(aa)||!ba.obj||!ba.obj.seen_timestamp)return;this.__serverRequests.handleUpdate({message_counts:[{seen_timestamp:ba.obj.seen_timestamp,folder:s.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:s.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__updateModelsFromMercuryPayload=function(aa,ba){"use strict";if(!this.$MercuryChannelHandlere(aa)||!ba.obj)return;this.$MercuryChannelHandler1.synchronizeInforms(function(){var ca=ba.obj,da=[];(ca.actions||[]).forEach(function(ea){var fa=i.USER_GENERATED_MESSAGE;if(ea.action_type==i.LOG_MESSAGE){var ga=l.CLIENT_CHANNEL_MESSAGE,ha;ha=ea.other_user_fbid||ea.thread_fbid;this.__serverRequests.handleUpdateWaitForThread({actions:[u({},ea)],payload_source:ga},ha);}else if(ea.action_type!=fa)da.push(ea);},this);ca.actions=da;ca.payload_source=l.CLIENT_CHANNEL_MESSAGE;this.__serverRequests.handleUpdate(ca);}.bind(this));};z.prototype.$MercuryChannelHandlerf=function(aa,ba){"use strict";this.__serverRequests.handleRoger(ba.obj);};z.prototype.$MercuryChannelHandlerg=function(aa,ba){"use strict";if(!this.$MercuryChannelHandler5(aa)||!ba.obj||ba.obj.mute_settings===(void 0)||(!ba.obj.thread_fbid&&!ba.obj.other_user_fbid))return;var ca=i.CHANGE_MUTE_SETTINGS,da=[{action_type:ca,action_id:null,thread_fbid:ba.obj.thread_fbid,other_user_fbid:ba.obj.other_user_fbid,mute_settings:ba.obj.mute_settings}];this.__serverRequests.handleUpdate({actions:da,payload_source:l.CLIENT_CHANNEL_MESSAGE});};z.prototype.__handleMessagingPayload=function(aa,ba){"use strict";switch(ba.obj.event){case q.DELIVER:this.$MercuryChannelHandler4(aa,ba);break;case q.READ:case q.UNREAD:this.$MercuryChannelHandler6(aa,ba);break;case q.READ_ALL:this.$MercuryChannelHandler9(aa,ba);break;case q.DELETE:this.$MercuryChannelHandler7(aa,ba);break;case q.DELETE_MESSAGES:this.$MercuryChannelHandler8(aa,ba);break;case q.TAG:this.$MercuryChannelHandlerc(aa,ba);break;case q.REPORT_SPAM:this.$MercuryChannelHandlerb(aa,ba);break;case q.READ_RECEIPT:this.$MercuryChannelHandlerf(aa,ba);break;case q.CHANGE_MUTE_SETTINGS:this.$MercuryChannelHandlerg(aa,ba);break;}};z.prototype.getRouting=function(){"use strict";return {mercury:this.__updateModelsFromMercuryPayload,messaging:this.__handleMessagingPayload,inbox:this.__markAsSeen};};z.prototype.__getMessagingPayloadType=function(){"use strict";return h.getArbiterType('messaging');};z.prototype.__getMercuryPayloadType=function(){"use strict";return h.getArbiterType('mercury');};z.prototype.__getInboxPayloadType=function(){"use strict";return h.getArbiterType('inbox');};z.prototype.$MercuryChannelHandler5=function(aa){"use strict";return (aa==this.__getMessagingPayloadType());};z.prototype.$MercuryChannelHandlere=function(aa){"use strict";return (aa==this.__getMercuryPayloadType());};z.prototype.$MercuryChannelHandlerd=function(aa){"use strict";return (aa==this.__getInboxPayloadType());};z.prototype.turnOn=function(){"use strict";if(!this.$MercuryChannelHandler3.length){var aa=this.getRouting();for(var ba in aa)this.$MercuryChannelHandler3.push(g.subscribe(h.getArbiterType(ba),aa[ba].bind(this)));}return this;};z.prototype.turnOff=function(){"use strict";if(this.$MercuryChannelHandler3.length){this.$MercuryChannelHandler3.forEach(g.unsubscribe);this.$MercuryChannelHandler3=[];}return this;};u(z,n);e.exports=z;},null);