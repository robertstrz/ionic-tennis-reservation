/*!CK:1599942746!*//*1433730266,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["clunI"]); }

__d("canUseReactEditor",["UserAgent"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h=typeof a.getSelection==='function',i=h&&((g.isPlatform('iOS')||g.isPlatform('Linux')||g.isPlatform('Mac OS X')||g.isPlatform('Windows')||g.isPlatform('Chrome OS'))&&(g.isBrowser('Chrome')||g.isBrowser('Firefox >= 16')||g.isBrowser('IE >= 9')||g.isBrowser('Opera >= 12')||g.isBrowser('Mobile Safari >= 6')||g.isBrowser('Safari >= 5')));function j(){return i;}e.exports=j;},null);
__d("applyEmoticonToContentBlock",["CharacterMetadata","ComposedEntityMutability","ComposedEntityType","DocumentEntity","EmoticonsList","immutable"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();'use strict';var m=l,n=m.List,o='\u3000';function p(q,r,s){if(!k.emotes[r])return q;var t=j.create(i.EMOTICON,h.IMMUTABLE,{type:k.emotes[r],originalEmoticon:r}),u=q.getText(),v=q.getCharacterList(),w=r.length,x=v.get(s);return q.merge({text:(u.slice(0,s)+o+u.slice(s+w)),characterList:v.slice(0,s).concat(n.of(g.applyEntity(x,t)),v.slice(s+w))});}e.exports=p;},null);
__d("getTextAfterNearestEntity",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){var j=i;while(j>0&&h.getEntityAt(j-1)===null)j--;return h.getText().slice(j,i);}e.exports=g;},null);
__d("applyEmoticonToContentState",["EmoticonsList","applyEmoticonToContentBlock","getTextAfterNearestEntity"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=new RegExp(g.regexp.source,'g');function k(l,m){var n=m.getAnchorKey(),o=m.getAnchorOffset(),p=l.getBlockForKey(n),q=i(p,o),r,s;while(s!==null){s=j.exec(q);if(s!==null)r=s;}if(!r)return l;var t=r[1];if(!t&&o!==q.length)return l;var u=r[2],v=o-q.length,w=v+r.index+r[1].length,x=l.getBlockMap().set(n,h(p,u,w));o-=(u.length-1);return l.merge({blockMap:x,selectionBefore:m,selectionAfter:m.merge({anchorOffset:o,focusOffset:o})});}e.exports=k;},null);
__d("handleBeforeInputForEmoticon",["DocumentModifier","EditorChangeType","EditorState","applyEmoticonToContentState"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();var k=new RegExp(/[\s'".,!?]/);function l(m,n){var o=m.getSelection();if(!o.isCollapsed()||!n||!k.test(n))return m;var p=m.getCurrentContent(),q=j(p,o);if(q===p)return m;var r=g.insertText(q,q.getSelectionAfter(),n);return i.push(m,r,h.INSERT_CHARACTERS);}e.exports=l;},null);
__d("handleSoftNewlineForEmoticon",["DocumentModifier","EditorChangeType","EditorState","applyEmoticonToContentState"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){var m=l.getCurrentContent(),n=l.getSelection(),o=j(m,n);if(o===m)return l;var p=g.splitBlock(o,o.getSelectionAfter());return i.push(l,p,h.SPLIT_BLOCK);}e.exports=k;},null);
__d("isSoftNewlineEvent",["Keys"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){return i.which===g.RETURN&&(i.getModifierState('Shift')||i.getModifierState('Alt')||i.getModifierState('Control'));}e.exports=h;},null);
__d("UFIMentionsInput.react",["Arbiter","BanzaiScuba","Bootloader","CommentPrelude","ComposedEntityMutability","ComposedEntityType","DocumentEntity","DocumentModifier","DOMVector","EditorChangeType","EditorState","Input","Keys","MentionsInput.react","React","SelectionState","URI","canUseReactEditor","createEditorStateWithEntities","createEmptyEditorState","createMentionEntity","cx","emptyFunction","getMentionsInputDecorator","getMentionsTextForContentState","getVisibleValueForContentState","handleBeforeInputForEmoticon","handleSoftNewlineForEmoticon","isSoftNewlineEvent","setImmediate"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja){b.__markCompiled&&b.__markCompiled();var ka=new h('ufi_tinder',null,{addBrowserFields:true,addGeoFields:true,addPredictedGeographyFields:true,addMobileDeviceFields:true,addUser:true}),la=200,ma=x();function na(ra){var sa=ra.map(function(ta){return {kind:'file',type:ta.type,getAsFile:ca.thatReturns(ta)};});return {clipboardData:{items:sa}};}function oa(ra){var sa=/^image\//;return ra.filter(function(ta){return sa.test(ta.type);});}var pa=u.createClass({displayName:"UFIMentionsInput",getInitialState:function(){var ra='',sa=[];if(this.props.initialData){ra=this.props.initialData.value||'';sa=this.props.initialData.mentions||[];sa=sa.map(function(ua){return Object.assign({},ua,{entity:{uid:ua.uid,weakreference:ua.weakreference}});});}var ta=y({text:ra,ranges:sa,decorator:da(),entityCreationFn:qa});ta=q.moveSelectionToEnd(ta);return {bootloaded:false,fullRender:!!(this.props.initialData&&this.props.initialData.value),typeaheadReporter:null,editorState:ta,mentionsSource:null,mentionableEntries:null,fallbackText:ra};},hasEnteredText:function(){return !!this.state.editorState.getCurrentContent().getPlainText().trim();},focus:function(){this._triggerFullRender(function(){if(ma){this.refs.mentionsInput.focus();}else u.findDOMNode(this.refs.textarea).focus();}.bind(this));},submitComment:function(event){if(this._submitComment(event))this._clearDocumentState();},insertMention:function(ra){this._triggerFullRender(function(){if(ma){var sa=this.state.editorState,ta=sa.getSelection(),ua=sa.getCurrentContent(),va=ta.getStartKey(),wa=ta.getStartOffset(),xa=ua.getBlockForKey(va),ya;if(xa.getText().substr(wa-1,1).trim().length>0){var za=n.replaceText(ua,ta,' ');ta=za.getSelectionAfter();ya=n.insertText(za,ta,ra.getTitle(),sa.getCurrentInlineStyle(),aa(ra));}else ya=n.replaceText(ua,ta,ra.getTitle(),sa.getCurrentInlineStyle(),aa(ra));sa=q.push(sa,ya,p.INSERT_FRAGMENT);sa=q.forceSelection(sa,sa.getSelection());this.setState({editorState:sa});this.focus();}else{u.findDOMNode(this.refs.textarea).focus();if(this.state.fallbackText.length){this.setState({fallbackText:this.state.fallbackText+' '+ra.title});}else this.setState({fallbackText:ra.title});}}.bind(this));},insertEmoticon:function(ra){if(!ma){this.setState({fallbackText:this.state.fallbackText+' '+ra});return;}var sa=this.state.editorState,ta=sa.getCurrentContent(),ua=sa.getSelection(),va=ta.getBlockForKey(ua.getStartKey()).getText()[ua.getStartOffset()-1];if(va&&va!==' ')ra=' '+ra;var wa=ta.getBlockForKey(ua.getEndKey()).getText()[ua.getEndOffset()];if(wa&&wa!==' ')ra+=' ';var xa=n.replaceText(sa.getCurrentContent(),sa.getSelection(),ra);sa=q.push(sa,xa,p.INSERT_CHARACTERS);sa=q.forceSelection(sa,sa.getSelection());this.setState({editorState:sa});},setSignature:function(ra){setTimeout(function(){var sa=this.state.editorState,ta=sa.getSelection(),ua=sa.getCurrentContent(),va=ua.getBlockMap().first(),wa=va.getKey();ta=new v({anchorKey:wa,anchorOffset:0,focusKey:wa,focusOffset:ra.length});ua=n.replaceText(ua,ta,ra);sa=q.set(sa,{currentContent:ua});this.setState({editorState:sa});}.bind(this),0);},_informHeightChange:function(){if(this.props.monitorHeight)ja(function(){if(!this.isMounted())return;var ra=ma?u.findDOMNode(this.refs.mentionsInput):u.findDOMNode(this.refs.textarea),sa=o.getElementDimensions(ra).y;if(sa!==this._height){this._height=sa;g.inform('ufi/inputHeightChanged',{node:ra});}}.bind(this));},_onChange:function(ra){this.setState({editorState:ra},this._informHeightChange);},_clearDocumentState:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();var ra=z(da());this.setState({editorState:q.moveFocusToEnd(ra)});},_handleContentReturn:function(ra){if(ia(ra)){var sa=ha(this.state.editorState);if(sa===this.state.editorState){return false;}else{this.setState({editorState:sa});return true;}}if(this._submitComment(ra)){this._clearDocumentState();return true;}return false;},_handleBeforeInput:function(ra){var sa=ga(this.state.editorState,ra);if(sa===this.state.editorState){return false;}else{this.setState({editorState:sa});return true;}},_submitComment:function(ra){var sa=this.state.editorState.getCurrentContent(),ta=fa(sa),ua=ea(sa),va={visibleValue:ta,encodedValue:ua},wa=r.getValue(u.findDOMNode(this.refs.proxyInput));if(wa){var xa=new w(a.location.href);ka.addNormal('path',xa.getPath());ka.addNormal('proxy_value',wa.substr(0,la));ka.post();}return this.props.onEnterSubmit(va,ra);},_handleFiles:function(ra){var sa=oa(ra);if(sa.length){this.props.onPaste(na(sa));return true;}return false;},_handleDroppedFiles:function(ra,sa){return this._handleFiles(sa);},_handlePastedFiles:function(ra){return this._handleFiles(ra);},_onMentionsInputBlur:function(){this.state.typeaheadReporter&&this.state.typeaheadReporter.sessionEnd();this.props.onBlur&&this.props.onBlur();g.inform('ufi/blur',{hasEnteredText:this.hasEnteredText()});},_onMentionsInputFocus:function(){if(!this.state.bootloaded&&!this._currentlyBootloading){this._currentlyBootloading=true;i.loadModules(["TypeaheadMetricReporter","getMentionsSearchSource"],function(ra,sa){if(!this.isMounted())return;var ta=new ra({event_name:'tinder_mentions'});ta.sessionStart();var ua=sa(this.props.datasource,ta);ua.bootstrap();this.setState({typeaheadReporter:ta,bootloaded:true,mentionsSource:ua},function(){this._currentlyBootloading=false;}.bind(this));}.bind(this));}else if(this.state.typeaheadReporter)this.state.typeaheadReporter.sessionStart();this.props.onFocus&&this.props.onFocus();g.inform('ufi/focus');},_onShowMentions:function(ra,sa){if(this.state.typeaheadReporter)this.state.typeaheadReporter.reportResults(ra.map(function(ta){return ta.getUniqueID();}));},_onAddMention:function(ra,sa,ta){if(this.state.typeaheadReporter){this.state.typeaheadReporter.reportSelect(ra.getUniqueID(),ra.getType(),sa,ta.button>=0);this.state.typeaheadReporter.sessionEnd();}},_onFallbackKeyDown:function(ra){if(ra.which!==s.RETURN)return;if(ia(ra)||!this.state.fallbackText.trim())return;ra.preventDefault();var sa={visibleValue:this.state.fallbackText,encodedValue:this.state.fallbackText};if(this.props.onEnterSubmit(sa,ra))this.setState({fallbackText:''});},_onFallbackChange:function(ra){this.setState({fallbackText:ra.target.value});},_onFallbackBlur:function(ra){this.props.onBlur&&this.props.onBlur();},_onFallbackFocus:function(ra){this.props.onFocus&&this.props.onFocus();},_sortByRenderType:function(ra,sa){var ta=ra.getAuxiliaryData().renderType,ua=sa.getAuxiliaryData().renderType;if(ta===ua)return ra.getOrder()-sa.getOrder();var va=this.props.viewOptionsTypeObjectsOrder;return va.indexOf(ta)-va.indexOf(ua);},_triggerFullRender:function(ra){this.setState({fullRender:true},ra);},_triggerFullRenderWithoutCallback:function(){this._triggerFullRender();},_renderFallback:function(){return (u.createElement("div",null,u.createElement("textarea",{ref:"textarea",className:"UFIAddCommentInput _1os9",name:"add_comment_text",placeholder:this.props.placeholder,spellCheck:true,onKeyDown:this._onFallbackKeyDown,onChange:this._onFallbackChange,onBlur:this._onFallbackBlur,onFocus:this._onFallbackFocus,value:this.state.fallbackText})));},_renderProxyInput:function(){if(!this.props.hideProxyInput){var ra="_1osa mentionsHidden";return (u.createElement("input",{className:ra,name:"add_comment_text",ref:"proxyInput",onFocus:this.focus,tabIndex:"-1"}));}},_renderDummy:function(){var ra="UFIAddCommentInput _1osb _1osc";return (u.createElement("div",{onFocus:this._triggerFullRenderWithoutCallback,onSelect:ca,onClick:this._triggerFullRenderWithoutCallback,onTouchStart:this._triggerFullRenderWithoutCallback,onMouseOver:this._triggerFullRenderWithoutCallback},this._renderProxyInput(),u.createElement("div",{className:ra},this.props.placeholder)));},_onClickEditorContainer:function(ra){j.click(ra.target,false);},_renderMentionsInput:function(){var ra="UFIAddCommentInput _1osb",sa=Object.assign({mentionSortFn:(this.props.viewOptionsTypeObjectsOrder?this._sortByRenderType:null)},this.props.viewProps);return (u.createElement("div",{onClick:this._onClickEditorContainer},this._renderProxyInput(),u.createElement(t,{ref:"mentionsInput",className:ra,editorState:this.state.editorState,onChange:this._onChange,mentionsSource:this.state.mentionsSource,typeaheadView:this.props.viewComponent,typeaheadViewProps:sa,spellCheck:true,placeholder:this.props.placeholder,onAddMention:this._onAddMention,onShowMentions:this._onShowMentions,onFocus:this._onMentionsInputFocus,onBlur:this._onMentionsInputBlur,handleContentReturn:this._handleContentReturn,handleBeforeInput:this._handleBeforeInput,handlePastedFiles:this._handlePastedFiles,handleDroppedFiles:this._handleDroppedFiles,autoflip:this.props.autoflip})));},componentDidMount:function(){if(!ma){if(this.state.fallbackText)u.findDOMNode(this.refs.textarea).focus();}else if(this.state.editorState.getCurrentContent().hasText())ja(function(){this.isMounted()&&this.focus();}.bind(this));},render:function(){if(!ma)return this._renderFallback();if(!this.state.fullRender)return this._renderDummy();return this._renderMentionsInput();}});function qa(ra){return m.create(l.MENTION,k.IMMUTABLE,{id:ra.uid,isWeak:ra.weakreference});}e.exports=pa;},null);