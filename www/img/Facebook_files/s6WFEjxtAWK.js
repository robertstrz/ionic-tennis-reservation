/*!CK:1511741363!*//*1433126569,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["4bDGV"]); }

__d("TickerReadStateTracking",["Style","clickRefAction"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i=73,j='ticker_hover',k=[];function l(n){if(!n)return null;var o=JSON.parse(n.getAttribute('data-ft'));if(!o)return null;if(o.mf_story_key)return o.mf_story_key;if(o.fbid)return o.fbid;return null;}function m(n){var o=l(n);if(!o||o in k)return;k[o]=true;var p={evt:i};h(j,n,null,'FORCE',{ft:p});}e.exports.log=m;},null);
__d("ContextualDialogFooterLink",["CSS","DOM","Event","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l){"use strict";this._layer=l;}k.prototype.enable=function(){"use strict";var l=this._layer.getRoot(),m=h.scry(l,'.uiContextualDialogFooterLink')[0],n='uiContextualDialogHoverFooterArrow';this._subscriptions=[i.listen(m,'mouseenter',g.addClass.bind(null,l,n)),i.listen(m,'mouseleave',g.removeClass.bind(null,l,n))];};k.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(l){l.remove();});this._subscriptions=null;};j(k.prototype,{_subscriptions:null});e.exports=k;},null);
__d("LayerHideOnSuccess",["copyProperties"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){"use strict";this._layer=i;}h.prototype.enable=function(){"use strict";this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));};h.prototype.disable=function(){"use strict";if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}};g(h.prototype,{_subscription:null});e.exports=h;},null);
__d("Overlay",["CSS","DataStore","DOM","Layer","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerMouseHooks","LayerTabIsolation","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();for(var w in j)if(j.hasOwnProperty(w))y[w]=j[w];var x=j===null?null:j.prototype;y.prototype=Object.create(x);y.prototype.constructor=y;y.__superConstructor__=j;function y(z,aa){"use strict";z=v({buildWrapper:true},z||{});this._shouldBuildWrapper=z.buildWrapper;j.call(this,z,aa);}y.prototype._configure=function(z,aa){"use strict";x._configure.call(this,z,aa);var ba=this.getRoot();this._overlay=i.scry(ba,'div.uiOverlay')[0]||ba;g.hide(ba);i.appendContent(this.getInsertParent(),ba);h.set(this._overlay,'overlay',this);var ca=h.get(this._overlay,'width');ca&&this.setWidth(ca);if(this.setFixed)this.setFixed(h.get(this._overlay,'fixed')=='true');if(h.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(n);if(h.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(m);if(h.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(r);if(h.get(this._overlay,'hideonblur')=='true')this.enableBehavior(p);if(h.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(l);return this;};y.prototype._getDefaultBehaviors=function(){"use strict";return x._getDefaultBehaviors.call(this).concat([k,o,t,q,s,u]);};y.prototype.initWithoutBuildingWrapper=function(){"use strict";this._shouldBuildWrapper=false;return this.init.apply(this,arguments);};y.prototype._buildWrapper=function(z,aa){"use strict";aa=x._buildWrapper.call(this,z,aa);if(!this._shouldBuildWrapper){this._contentRoot=aa;return aa;}this._contentRoot=i.create('div',{className:'uiOverlayContent'},aa);return i.create('div',{className:'uiOverlay'},this._contentRoot);};y.prototype.getContentRoot=function(){"use strict";return this._contentRoot;};y.prototype.destroy=function(){"use strict";h.remove(this.getRoot(),'overlay');x.destroy.call(this);};e.exports=y;},null);
__d("LegacyContextualDialog",["Arbiter","ArbiterMixin","ARIA","Bootloader","ContextualDialogFooterLink","ContextualThing","CSS","DataStore","DOM","Event","LayerAutoFocus","LayerRefocusOnHide","Locale","Overlay","Parent","Scroll","Style","Vector","$","copyProperties","getOverlayZIndex","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){b.__markCompiled&&b.__markCompiled();for(var ca in t)if(t.hasOwnProperty(ca))ea[ca]=t[ca];var da=t===null?null:t.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=t;function ea(){"use strict";if(t!==null)t.apply(this,arguments);}ea.prototype._configure=function(fa,ga){"use strict";da._configure.call(this,fa,ga);var ha=this.getRoot(),ia=n.get.bind(null,ha);this.setAlignH(ia('alignh','left'));this.setOffsetX(ia('offsetx',0));this.setOffsetY(ia('offsety',0));this.setPosition(ia('position','above'));this._hasFooter=ia('hasfooter',false);if(this._hasFooter){var ja=o.scry(ha,'.uiContextualDialogFooterLink')[0];ja&&this.enableBehavior(k);}this.enableBehaviors(this._getDefaultBehaviors());this._setContextSubscription=this.subscribe('beforeshow',function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var la=ia('context');if(la){this.setContext(y(la));}else{la=ia('contextselector');if(la)this.setContext(o.find(document,la));}}.bind(this));this._content=o.scry(ha,'.uiContextualDialogContent')[0];if(this._content){this._content.setAttribute('role','dialog');var ka=o.scry(this._content,'.legacyContextualDialogTitle')[0];if(ka)this._content.setAttribute('aria-labelledby',o.getID(ka));}this._showSubscription=this.subscribe('show',function(){var la=ba(this.updatePosition,this);this._resizeListener=p.listen(window,'resize',la);this._reflowSubscription=g.subscribe('reflow',la);this._setupScrollListener(this._scrollParent);l.register(ha,this.context);g.inform('layer_shown',{type:'ContextualDialog'});}.bind(this));this._hideSubscription=this.subscribe('hide',function(){this._teardownResizeAndReflowListeners();this._teardownScrollListener();g.inform('layer_hidden',{type:'ContextualDialog'});}.bind(this));return this;};ea.prototype._getDefaultBehaviors=function(){"use strict";return da._getDefaultBehaviors.call(this).concat([q,r]);};ea.prototype._buildWrapper=function(fa,ga){"use strict";var ha=da._buildWrapper.call(this,fa,ga);if(!this._shouldBuildWrapper)return ha;m.addClass(ha,'uiContextualDialog');return o.create('div',{className:'uiContextualDialogPositioner'},ha);};ea.prototype.setWidth=function(fa){"use strict";this._width=Math.floor(fa);return this;};ea.prototype.setFixed=function(fa){"use strict";fa=!!fa;m.conditionClass(this.getRoot(),'uiContextualDialogFixed',fa);this._fixed=fa;return this;};ea.prototype.setAlignH=function(fa){"use strict";this.alignH=fa;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;};ea.prototype.getContent=function(){"use strict";return this._content;};ea.prototype.getContext=function(){"use strict";return this.context;};ea.prototype.setContext=function(fa){"use strict";if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}fa=y(fa);if(this.context&&this.context!=fa)n.remove(this.context,'LegacyContextualDialog');this.context=fa;i.setPopup(this.getCausalElement(),this.getRoot());var ga=u.byClass(fa,'fbPhotoSnowlift');this.setInsertParent(ga||document.body);if(this._scrollListener&&this._scrollParent!==ga){this._teardownScrollListener();this._setupScrollListener(ga);}this._scrollParent=ga;var ha=aa(fa,this._insertParent);w.set(this.getRoot(),'z-index',ha>200?ha:'');n.set(this.context,'LegacyContextualDialog',this);return this;};ea.prototype.getCausalElement=function(){"use strict";return da.getCausalElement.call(this)||this.context;};ea.prototype.listen=function(fa,ga){"use strict";return p.listen(this.getRoot(),fa,ga);};ea.prototype.setOffsetX=function(fa){"use strict";this.offsetX=parseInt(fa,10)||0;this._shown&&this.updatePosition();return this;};ea.prototype.setOffsetY=function(fa){"use strict";this.offsetY=parseInt(fa,10)||0;this._shown&&this.updatePosition();return this;};ea.prototype.setPosition=function(fa){"use strict";this.position=fa;for(var ga in ea.POSITION_TO_CLASS)m.conditionClass(this.getRoot(),ea.POSITION_TO_CLASS[ga],fa==ga);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;};ea.prototype.updatePosition=function(){"use strict";if(!this.context)return false;if(this._width)w.set(this._overlay,'width',this._width+'px');var fa=this._fixed?'viewport':'document',ga=x.getElementPosition(this.context,fa),ha=this._scrollParent;if(ha)ga=ga.sub(x.getElementPosition(ha,'document')).add(v.getLeft(ha),v.getTop(ha));var ia=x.getElementDimensions(this.context),ja=this.position=='above'||this.position=='below',ka=s.isRTL();if((this.position=='right'||(ja&&this.alignH=='right'))!=ka)ga=ga.add(ia.x,0);if(this.position=='below')ga=ga.add(0,ia.y);var la=new x(0,0);if(ja&&this.alignH=='center'){la=la.add((ia.x-this._width)/2,0);}else{var ma=ja?ia.x:ia.y,na=2*ea.ARROW_INSET;if(ma<na){var oa=ma/2-ea.ARROW_INSET;if(ja&&(this.alignH=='right'!=ka))oa=-oa;la=la.add(ja?oa:0,ja?0:oa);}}la=la.add(this.offsetX,this.offsetY);if(ka)la=la.mul(-1,1);ga=ga.add(la);if(this._fixed)ga=new x(ga.x,ga.y,'document');ga.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;};ea.prototype.scrollTo=function(){"use strict";if(this.context)j.loadModules(["DOMScroll"],function(fa){fa.scrollTo(this.context,true,true);}.bind(this));};ea.prototype.destroy=function(){"use strict";this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}this._teardownScrollListener();this._teardownResizeAndReflowListeners();this.context&&n.remove(this.context,'LegacyContextualDialog');da.destroy.call(this);};ea.prototype._adjustVerticalPosition=function(){"use strict";if(this.position!='left'&&this.position!='right'){w.set(this._overlay,'top','');return;}var fa=this.getRoot(),ga=x.getElementPosition(fa,'viewport').y,ha=x.getElementDimensions(this._overlay).y,ia=x.getViewportDimensions().y,ja=Math.min(Math.max(ga,ea.MIN_TOP_GAP),ea.TOP_MARGIN),ka=Math.min(Math.max(0,ga+ha+ea.BOTTOM_MARGIN-ia),Math.max(-ja,ga-ja),ha-2*ea.ARROW_INSET);w.set(this._overlay,'top',(-1*ka)+'px');w.set(this._arrow,'top',ea.ARROW_OFFSET+'px');w.set(this._arrow,'marginTop',ka+'px');};ea.prototype._adjustHorizontalPosition=function(){"use strict";if((this.position!='above'&&this.position!='below')||this.alignH!='left'){w.set(this._overlay,'left','');w.set(this._overlay,'right','');return;}var fa=this.getRoot(),ga=x.getElementPosition(fa,'viewport').x,ha=x.getElementDimensions(this._overlay).x,ia=x.getViewportDimensions().x,ja=s.isRTL(),ka;if(!ja){ka=ga+ha+ea.RIGHT_MARGIN-ia;}else ka=ea.LEFT_MARGIN+ha-ga;ka=Math.min(Math.max(0,ka),ha-2*ea.ARROW_INSET);w.set(this._overlay,ja?'right':'left',-1*ka+'px');w.set(this._arrow,ja?'right':'left',ea.ARROW_OFFSET+'px');w.set(this._arrow,ja?'marginRight':'marginLeft',ka+'px');};ea.prototype._updateArrow=function(){"use strict";var fa=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':fa=50;break;case 'right':fa=100;break;}this._renderArrow(ea.POSITION_TO_ARROW[this.position],fa);};ea.prototype._renderArrow=function(fa,ga){"use strict";for(var ha in ea.ARROW_CLASS)m.conditionClass(this._overlay,ea.ARROW_CLASS[ha],fa==ha);m.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',fa=='bottom'&&this._hasFooter);if(fa=='none')return;if(!this._arrow){this._arrow=o.create('i',{className:'uiContextualDialogArrow'});o.appendContent(this._overlay,this._arrow);}w.set(this._arrow,'top','');w.set(this._arrow,'left','');w.set(this._arrow,'right','');w.set(this._arrow,'margin','');var ia=fa=='top'||fa=='bottom',ja=ia?(s.isRTL()?'right':'left'):'top';ga=ga||0;w.set(this._arrow,ja,ga+'%');var ka=ea.ARROW_LENGTH+ea.ARROW_OFFSET*2,la=-(ka*ga/100-ea.ARROW_OFFSET);w.set(this._arrow,'margin-'+ja,la+'px');};ea.prototype._updateAlignmentClass=function(){"use strict";m.conditionClass(this.getRoot(),ea.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');};ea.prototype._setupScrollListener=function(fa){"use strict";this._scrollListener=p.listen(fa||window,'scroll',ba(this._adjustVerticalPosition,this));};ea.prototype._teardownScrollListener=function(){"use strict";if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}};ea.prototype._teardownResizeAndReflowListeners=function(){"use strict";if(this._resizeListener){this._resizeListener.remove();this._resizeListener=null;}if(this._reflowSubscription){this._reflowSubscription.unsubscribe();this._reflowSubscription=null;}};ea.getInstance=function(fa){"use strict";var ga=n.get(fa,'LegacyContextualDialog');if(!ga){var ha=u.byClass(fa,'uiOverlay');if(ha)ga=n.get(ha,'overlay');}return ga;};z(ea,h,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:50,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,MIN_TOP_GAP:5,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'}});z(ea.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_setContextSubscription:null,_resizeListener:null,_reflowSubscription:null});e.exports=ea;},null);
__d("TickerController",["Event","Animation","Arbiter","AsyncRequest","AsyncSignal","Bootloader","ChannelConstants","LegacyContextualDialog","CSS","DOM","HTML","Keys","LayerFadeOnHide","LiveTimer","NavigationMessage","Parent","Rect","Run","ScrollableArea","SelectorDeprecated","Style","TickerReadStateTracking","Toggler","UIPagelet","URI","UserActivity","UserAgent_DEPRECATED","Vector","DOMVector","BanzaiODS","$","clickRefAction","collectDataAttributes","containsNode","copyProperties","cx","csx","ex","emptyFunction","ge","getElementText","goURI","throttle","tickerPhoteSnowLiftOpenStatus"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa){b.__markCompiled&&b.__markCompiled();var ya=1,za=2,ab=3,bb=4,cb=15000;function db(eb,fb,gb){if(eb===(void 0))return;db._instances[eb.id]=this;db._activeInstance=this;this._root=eb;this._content=p.find(eb,'.ticker_stream');this._stories=p.find(this._root,'.tickerActivityStories');this._scrollableArea=fb;this._container=p.find(eb,'div.uiScrollableAreaWrap');this._newestStory={};this._objectIDs=[];this._fetchedStories={};this._fetchedStoriesDialog={};this._storyDialogResources={};this._removedStoryIDs=[];this._storiesToRemove=[];var hb=Date.now();this._initTime=hb;this._lastUpdate=hb;this._lastPull=hb;this._lastInsert=hb;this._pollOnly=false;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=p.find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!v.byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();la('ticker_flyout');la('ticker_flyout_prefetch');la('ticker_flyout_loadtime');la('ticker_stream');this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var ib=p.create('div',{className:'storyQueue hidden_elem'});this._storyQueue=ib;p.appendContent(this._root,ib);this._lastKStories={head:null,tail:null,count:0,actors:{},apps:{},stories:{}};this._dedupeKeys={};this._initObjectIDs();this._initConfig(gb);this._resetMorePager();this._initListeners();this._initSubscriptions(gb);i.inform('ticker/init',this,i.BEHAVIOR_PERSISTENT);this._poll();}oa(db,{_instances:{},_activeInstance:null,_placeholders:{},getInstance:function(eb){var fb=v.byClass(ka(eb),'fbFeedTicker');return fb?db._instances[fb.id]:null;},isLoaded:function(eb){var fb=db._placeholders[eb.id];return !fb||fb.status==ab;},show:function(eb,fb){fb=fb||sa;for(var gb in db._instances){var hb=ta(gb);if(!hb||hb.parentNode.id==eb.id)continue;db.hide(hb.parentNode);}db._doPositionChange(eb);o.show(eb);var ib=db._placeholders[eb.id];if(ib&&ib.status==ya){var jb=(ha.getElementDimensions(eb).y||0)>0,kb=eb.id==='pagelet_rhc_ticker'&&!o.hasClass(eb,'hidden_rhc_ticker');if(jb||kb){db._fetchTickerForPlaceholder(eb,fb);}else i.subscribe('Ticker/resized',function(){if(ib.status==ya)db._fetchTickerForPlaceholder(eb,fb);});}else{var lb=p.scry(eb,'.fbFeedTicker')[0],mb=lb&&db.getInstance(lb);db._activeInstance=mb;mb&&mb._poll();db._placeholders[eb.id]={status:bb,callback:fb};fb();}i.inform('ticker/show',{node:eb,callback:fb});},_doPositionChange:function(eb){if(o.shown(eb))return;new k('/common/ods_endpoint.php',{k:'ticker.render.switch.'+eb.id}).send();},hide:function(eb){var fb=p.scry(eb,'.fbFeedTicker')[0],gb=fb&&db.getInstance(fb);gb&&gb.hideActiveStory();o.hide(eb);},hideStoriesByClass:function(eb){for(var fb in db._instances)p.scry(ka(fb),eb).forEach(o.hide);},hideStory:function(eb){var fb=eb&&db.getInstance(eb);fb&&fb.hideStory(eb);},replaceStory:function(eb,fb){var gb=p.scry(document.body,'div.fbFeedTickerStory'),hb=db.getInstance(gb[0]),ib=hb._findStoryById(eb);hb.handleRemoveStory();o.hide(ib);p.insertAfter(ib,fb);fb.setAttribute('data-story-id',ib.getAttribute('id'));var jb=setTimeout(function(){db.removeMarkup(fb,ib);},cb);fb.setAttribute('data-timeout-token',jb);},removeMarkup:function(eb,fb){o.addClass(eb,'removedStoryMarkup');new h(eb).to('height',0).duration(500).ondone(function(){p.remove(eb);}).go();},undoHideStory:function(eb){var fb=eb&&db.getInstance(eb);fb&&fb.undoHideStory(eb);},insertStoriesAtBottom:function(eb){db._activeInstance.insertStoriesAtBottom(eb);},_fetchTickerForPlaceholder:function(eb,fb){var gb={handler:function(){db._placeholders[eb.id].status=ab;fb();}};da.loadFromEndpoint('TickerEntStoryPagelet',eb.id,db._placeholders[eb.id].pageletData,gb);db._placeholders[eb.id].status=za;},registerStoryDialog:function(eb,fb){i.subscribe('ticker/init',function(){var gb=ta(eb),hb=gb&&db.getInstance(gb);hb&&hb.registerStoryDialog(gb,fb);},i.SUBSCRIBE_ALL);},registerPlaceholder:function(eb,fb){var gb=db._placeholders[eb];db._placeholders[eb]={status:ya,pageletData:fb};if(gb&&gb.status==bb){db.show(ka(eb));gb.callback();}}});oa(db.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_ACTION_FOOTER_PADDING:8,FLYOUT_TARGET_HEIGHT_OFFSET:25,DEFAULT_LOOK_BEHIND:10,init:function(eb,fb,gb){new db(eb,fb,gb);},_lastKStoriesInsert:function(eb){this._lastKStories.stories[eb.getAttribute("data-story-key")]=true;var fb={story:eb,next:null};if(this._lastKStories.head)this._lastKStories.head.next=fb;this._lastKStories.head=fb;this._lastKStories.count++;if(!this._lastKStories.tail)this._lastKStories.tail=this._lastKStories.head;var gb=eb.getAttribute("data-actor");if(!this._lastKStories.actors[gb])this._lastKStories.actors[gb]=0;this._lastKStories.actors[gb]++;var hb=eb.getAttribute("data-app");if(hb){if(!this._lastKStories.apps[hb])this._lastKStories.apps[hb]=0;this._lastKStories.apps[hb]++;}if(this._lastKStories.count>this.DEFAULT_LOOK_BEHIND){while(this._lastKStories.tail&&!this._lastKStoriesRemove(this._lastKStories.tail.story))this._lastKStories.tail=this._lastKStories.tail.next;if(!this._lastKStories.tail)this._lastKStories.head=null;}},_lastKStoriesRemove:function(eb){var fb=eb.getAttribute("data-story-key"),gb=eb.getAttribute("data-actor"),hb=eb.getAttribute("data-app");if(this._lastKStories.stories[fb]){delete this._lastKStories.stories[fb];this._lastKStories.actors[gb]--;if(hb)this._lastKStories.apps[hb]--;this._lastKStories.count--;return true;}else return false;},_loadStoriesWithActions:function(){var eb=ta('rightCol');if(!eb)return;this._toggleWrapper=p.scry(eb,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var fb=p.scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var gb=0;gb<fb.length;gb++){var hb=fb[gb];this._storiesWithActions[hb.getAttribute('data-story-key')]=hb;}}},_initConfig:function(eb){oa(this,{_newest:eb.newest,_page_newest:eb.newest,_timeout:eb.timeout,_heartbeatTimeout:Math.min(5000,eb.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,eb.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,eb.pullTimeout),_insertTimeout:eb.insertTimeout,_maxQueueLength:eb.maxQueueLength,_heartbeatEndpoint:eb.heartbeatEndpoint,_popupOnHover:eb.popupOnHover,_userIdleTimeout:eb.userIdleTimeout,_pollOnly:eb.pollOnly,_tickerSource:eb.tickerSource,_logFlyouts:eb.logFlyouts,_userScrollGaurdDelay:eb.userScrollGaurdDelay,_rescheduleScrollToTopDelay:eb.rescheduleScrollToTopDelay});},_initListeners:function(){this._listeners=g.listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=g.listen(this._container,'scroll',this._handleScroll.bind(this));setTimeout(this._initInfiniteScrollListener.bind(this),0);},_initSubscriptions:function(eb){x.onLeave(this._cleanup.bind(this));this._subscriptions=[i.subscribe(u.NAVIGATION_BEGIN,this._onNavHandler.bind(this)),i.subscribe('composer/publish',this._handleComposerPublish.bind(this)),i.subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),i.subscribe('Ticker/fixed',this._setFixed.bind(this,true)),i.subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),i.subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),i.subscribe('ufi/comment',this._scrollDialogToBottom.bind(this)),i.subscribe('ufi/changed',this._redrawFlyout.bind(this)),i.subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(!eb.pollOnly)this._subscriptions.push(i.subscribe(m.getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(eb.pushChannel&&!eb.pollOnly)this.setPushChannel(eb.pushChannel);},_handleClick:function(event){if(!(event.button===1||event.altKey||event.ctrlKey||event.metaKey))event.prevent();var eb=event.getTarget();if(this._getButtonFromNode(eb)){this._logUserAction(eb,'click',event);this._handleActionButton(event);return;}var fb=this._getStoryFromNode(eb),gb=v.byClass(eb,'tickerStoryAllowClick');if(!fb||fb==this._selectedStory||gb)return;if(this._storyIsHidden(fb))return;if(fb==this._activeStory&&!this._selectedStory)this._selecting=true;if(this._storyCanOpenExternally(fb)){var hb=fb.getAttribute('data-href');if(hb&&!eb.getAttribute('href')){var ib={href:hb},jb=ma(eb,['ft','gt']);la('click',ib,event,'FORCE',jb);}else this._logUserAction(eb,'click',event);this._openStoryExternally(fb,event);return;}this._logUserAction(eb,'flyout',event);this._activateStory(fb,'click');this._selectStory(fb);},_handleMouseover:function(event){this._setLocked(true);var eb=event.getTarget(),fb=this._getOpenableStory(eb);if(!fb){var gb=v.byClass(eb,"_5wvy");if(gb){clearTimeout(parseInt(gb.getAttribute('data-timeout-token'),10));var hb=setTimeout(function(){db.removeMarkup(gb,fb);},cb);gb.setAttribute('data-timeout-token',hb);}return;}event.kill();if(this._popupOnHover){if(!(fb.id in this._fetchedStories))this._uaCurStoryIDPrefetch=fb.id;this._fetchStory(fb);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var ib=this._storyCanOpenExternally(fb)?500:1000,jb=this._activeStory?75:ib;this._hoverShowTimeout=this._setTimeout(function(){this._activateStory(fb,'hover');this._logUserAction(eb,'flyout',event);}.bind(this),jb);}},_handleMouseout:function(event){var eb=event.getTarget();this._setLocked(false);if(eb==this._getStoryFromNode(eb)){var fb=p.scry(eb.parentNode,'.openToggler');for(var gb=0;gb<fb.length;gb++)z.toggle(fb[gb]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function(event){this._tickerDeClicker(event);var eb=this._activeStory;if(!eb)return;var fb=g.getKeyCode(event);switch(fb){case r.UP:case r.DOWN:var gb=this._getInsertedStories(),hb;if(event.getModifiers().any){hb=fb===r.UP?0:gb.length-1;}else hb=gb.indexOf(eb)+(fb===r.UP?-1:1);eb=gb[hb];break;case r.ESC:this._deactivateStory(true);return;default:return;}event.kill();if(!eb)return;this._activateStory(eb,'keypress');this._selectStory(eb);},_fadeTopmostStoryButton:function(){var eb=0,fb=15;if(this._storiesWithActions)for(var gb in this._storiesWithActions){var hb=this._storiesWithActions[gb],ib=p.scry(hb,'.tickerInlineActionButton')[0],jb=p.scry(ib,'.tickerActionIcon')[0],kb=ha.getElementPosition(ib).y-ha.getElementPosition(this._toggleWrapper).y;if(kb<eb){aa.set(ib,'opacity',0);aa.set(jb,'opacity',0);}else if(kb>=eb&&kb<fb){var lb=(kb-eb)/(fb-eb);aa.set(ib,'opacity',lb);aa.set(jb,'opacity',lb);break;}else{aa.set(ib,'opacity',1);aa.set(jb,'opacity',1);}}},_handleScroll:function(){var eb=xa.checkIsOpen();if(eb)this._preventFlyoutDismiss=true;if(!this._preventScrollDismiss&&!eb){if(!this._preventFlyoutDismiss){this._deactivateStory(true);}else this._preventFlyoutDismiss=false;}else this._preventScrollDismiss=false;if(!this._handleScrollThrottled)this._handleScrollThrottled=wa(this._handleScrollInner.bind(this));this._handleScrollThrottled();},_handleScrollInner:function(){this._fadeTopmostStoryButton();this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var eb=this._stories.childNodes.length,fb=this._stories.getAttribute('data-gt'),gb={ticker_scroll:1,number_stories:eb,source:fb};la('scroll',null,null,'FORCE',{gt:gb});}},_setIsUserScrolling:function(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=setTimeout(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function(){return this._userScrolling;},_handleStoriesInserted:function(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof y)this._scrollableArea.adjustGripper();},_handleActionButton:function(event){var eb=event.getTarget(),fb=this._getOpenableStory(eb),gb=this._getStoryDialog(fb);if(gb)var hb=gb.subscribe('beforehide',function(){gb.unsubscribe(hb);return false;});},_handleScrollToTopClick:function(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=setTimeout(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function(eb){new h(this._container).to('scrollTop',0).ease(h.ease.end).ondone(eb).go();},_clearHoverTimeouts:function(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function(){return p.scry(this._root,'div.fbFeedTickerStory');},_findStoryById:function(eb){var fb=p.scry(this._root,'.fbFeedTickerStory'),gb;for(story in fb){gb=fb[story];if(eb==this._getStoryDialogParams(gb).token)return gb;}return null;},_getInsertedStories:function(){return this._getAllStories().filter(function(eb){return !o.hasClass(eb,'queuedStory');});},_getQueuedStories:function(){return p.scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getButtonFromNode:function(eb){return v.byClass(eb,'tickerInlineOverlay');},_getStoryFromNode:function(eb){return v.byClass(eb,'fbFeedTickerStory');},_getActionButtonFromStory:function(eb){return p.scry(eb,'.tickerInlineActionButton')[0];},_getOpenableStory:function(eb){var fb=this._getStoryFromNode(eb);return this._storyCanOpenDialog(fb)?fb:null;},_getStoryDialog:function(eb){return this._fetchedStoriesDialog[eb.id]||n.getInstance(eb);},_getStoryDialogParams:function(eb){var fb=eb&&eb.getAttribute('data-flyoutdata')||null;return fb&&JSON.parse(fb)||null;},_storyCanOpenDialog:function(eb){return !!this._getStoryDialogParams(eb)&&!this._storyIsHidden(eb);},_storyCanOpenExternally:function(eb){return !!eb.getAttribute('data-href')||!this._storyCanOpenDialog(eb);},_storyIsHidden:function(eb){return o.hasClass(eb,'tickerStoryHidden');},hideActiveStory:function(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function(eb){this._deactivateStory();if(ua(eb)==='')p.remove(eb);o.addClass(eb,'tickerStoryHidden');o.removeClass(eb,'tickerStoryClickable');},undoHideStory:function(eb){o.addClass(eb,'tickerStoryClickable');o.removeClass(eb,'tickerStoryHidden');},insertStoriesAtBottom:function(eb){if(!eb)return;var fb=p.create('div');fb.appendChild(eb);var gb=p.scry(fb,'.fbFeedTickerStory'),hb=p.find(fb,'.tickerMorePager'),ib=[];for(var jb=0;jb<gb.length;jb++)if(!this.dedupeStory(gb[jb]))ib.push(gb[jb]);if(ib.length){ib.push(hb);p.replace(p.find(this._root,'.tickerMorePager'),ib);}i.inform('Ticker/storiesInserted');},_scheduleHide:function(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function(eb){this._scrollTopPromptVisible=eb;o.conditionShow(this._scrollTopPrompt,eb);if(eb&&!this._listeners.scrollTop){this._listeners.scrollTop=g.listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!eb&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function(){return !fa.isActive(this._userIdleTimeout);},_schedulePoll:function(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var eb=this._storiesToRemove.pop();this.removeStory(eb);}var fb=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(fb);var gb=Date.now(),hb=gb-this._lastInsert;if(hb<this._insertTimeout||this._isLocked())return this._schedulePoll();var ib=this._getQueuedStories(),jb=this._isUserIdle(),kb=ib.length>0;if(kb){var lb=ib.shift();this.insertStory(lb);return this._schedulePoll();}if(jb)return fa.subscribeOnce(this._poll.bind(this));var mb=false,nb=false;if(this._pollOnly){nb=gb-this._lastUpdate>this._heartbeatTimeout;}else mb=(gb-this._lastPull>this._pullTimeout);var ob=mb||nb;if(!ob)return this._schedulePoll();this.update({pull:mb,fullpoll:nb});},_updatePollOnlyHeartbeatTimeout:function(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function(eb){this._updatePollOnlyHeartbeatTimeout();if(!this._pollOnly)return this._schedulePoll();var fb={newest:(eb.fullpoll||eb.cache_update)?this._newest:this._page_newest,source:this._tickerSource};if(!fb.newest||fb.newest==='0')throw new Error(ra('Trying to request new ticker stories with an invalid cursor %s, with'+' the settings fullpoll %s, cache_update %s, value coming from this.%s',typeof fb.newest==='string'?'"'+fb.newest+'"':fb.newest,eb.fullpoll,eb.cache_update,(eb.fullpoll||eb.cache_update)?'_newest':'_page_newest'));oa(fb,eb);new j().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(fb).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(fb.pull)this._lastPull=this._lastUpdate;},insertStory:function(eb){this._lastInsert=Date.now();window.LiveTimer&&t.addTimeStamps(eb);o.removeClass(eb,'queuedStory');if(this._isUserScrolling()){this._fadeStoryIn(eb);}else this._scrollToTop(this._flyStoryIn.bind(this,eb));if(this._storiesWithActions&&o.hasClass(eb,'tickerStoryWithButton'))this._storiesWithActions[eb.getAttribute('data-story-key')]=eb;this._removeOldStories();},_removeOldStories:function(){var eb=this._getInsertedStories();if(eb.length<=this._maxStoriesToKeep)return;var fb=this._minStoriesToKeep,gb=eb.slice(fb);gb.forEach(p.remove);if(this._storiesWithActions)for(var hb=0;hb<gb.length;hb++)delete this._storiesWithActions[gb[hb].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function(){var eb=this._getInsertedStories();if(!eb||!eb.length)return;var fb=eb[eb.length-1].getAttribute('data-ticker-timestamp'),gb=p.scry(this._root,'.tickerMorePager a')[0];if(!gb||!fb)return;var hb=new ea(gb.getAttribute('ajaxify'));hb.addQueryData({oldest:fb});gb.setAttribute('ajaxify',hb);},_setLocked:function(eb){this._locked=eb;},_isLocked:function(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function(eb,fb,gb){var hb=this._getStoryFromNode(eb),ib=hb.getAttribute('data-story-key');p.setContent(hb,fb);o.addClass(hb,'highlightedStory');this._setTimeout(this.removeStory.bind(this,ib),gb||6000);},_getStoryByStoryKey:function(eb){var fb=this._getAllStories();for(var gb=0;gb<fb.length;gb++){var hb=fb[gb];if(hb.getAttribute('data-story-key')==eb)return hb;}return null;},removeStory:function(eb){this._removedStoryIDs[eb]=true;var fb=this._getStoryByStoryKey(eb);if(!fb)return;if(this._storiesWithActions)delete this._storiesWithActions[eb];if(fb==this._activeStory)this._deactivateStory();var gb=this._getStoryDialog(fb);gb&&gb.destroy();this._lastKStoriesRemove(fb);var hb=fb.getAttribute("data-dedupe-key");if(hb)delete this._dedupeKeys[hb];if(o.hasClass(fb,'queuedStory')){p.remove(fb);return;}this._animateStoryOut(fb);},_isScrolledToTop:function(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function(eb){var fb=p.create('div',{style:{marginTop:'-1000px'}},eb);aa.set(fb,'opacity',0);p.prependContent(this._stories,fb);var gb=ha.getElementDimensions(fb).y;aa.set(fb,'marginTop','-'+gb+'px');this._isInsertingStory=true;new h(fb).to('marginTop',0).ease(h.ease.end).checkpoint(.5).to('opacity',1).ondone(function(){p.replace(fb,eb);this._afterInsert(eb);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function(eb){new h(this._stories).to('opacity',.5).ondone(function(){p.prependContent(this._stories,eb);this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();new h(this._stories).to('opacity',1).ondone(function(){this._afterInsert(eb);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function(eb){var fb=p.create('div',{style:{overflow:'hidden',position:'relative'}});p.insertBefore(eb,fb);p.appendContent(fb,eb);new h(fb).to('top',20).to('height',0).to('opacity',0).ease(h.ease.end).ondone(function(){p.remove(fb);i.inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function(eb){i.inform('Ticker/afterInsert');},setPushChannel:function(eb){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=i.subscribe(m.getArbiterType(eb),this._handleTickerPush.bind(this));d(['ChatConfig','ChannelConnection'],function(fb,gb){this._channelConnection=gb;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function(){o.conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},_handleTickerPush:function(eb,fb){var gb=fb.obj;if(gb.delete_id){this._storiesToRemove.push(gb.delete_id);return;}var hb=gb.story_xhp;if(!hb)return;var ib=q(hb).getRootNode();if(!gb.story_time||gb.story_time==='0')throw new Error(ra('An invalid story time was pushed: %s, for ticker story: %s',typeof gb.story_time==='string'?'"'+gb.story_time+'"':gb.story_time,ib.getAttribute('data-flyoutdata')));this._newest=gb.story_time;this.queueStory(ib,gb.flyout_js_cmds);this._newestStory={actorID:gb.actor,storyKey:ib.getAttribute('data-story-key')};},_handleComposerPublish:function(eb,fb){fb.tickerMarkup&&this.insertStory(fb.tickerMarkup);},_logRender:function(){if(this._loggedRender)return;var eb=this._tickerInSidebarMode;if(eb||v.byClass(this._content,'home_right_column')){new k('/ajax/log_ticker_render.php',{sidebar_mode:eb}).send();this._loggedRender=true;}},_isTickerVisible:function(){var eb=(db._activeInstance==this);eb&&this._logRender();return eb;},_handleResponse:function(eb){var fb=eb.getPayload();if(fb.newest)this._newest=this._page_newest=fb.newest;if(fb.content)if(fb.content instanceof Array){for(var gb=0;gb<fb.content.length;gb++)this.queueStoryMarkup(fb.content[gb]);}else this.queueStoryMarkup(fb.content);},queueStoryMarkup:function(eb){var fb=q(eb).getRootNode();this.queueStory(fb);},dedupeStory:function(eb){var fb=eb.getAttribute('data-story-key'),gb=fb&&(!!this._objectIDs[fb]||!!this._removedStoryIDs[fb]);gb=gb||!!this._lastKStories.actors[eb.getAttribute('data-actor')]||!!this._lastKStories.apps[eb.getAttribute('data-app')];var hb=eb.getAttribute('data-dedupe-key');gb=gb||hb&&this._dedupeKeys[hb];if(eb.getAttribute('data-force-push'))gb=false;fb&&(this._objectIDs[fb]=true);return gb;},queueStory:function(eb,fb){if(this.dedupeStory(eb))return;this._lastKStoriesInsert(eb);var gb=eb.getAttribute("data-dedupe-key");if(gb)this._dedupeKeys[gb]=true;o.addClass(eb,'queuedStory');p.appendContent(this._storyQueue,eb);var hb=fb&&fb.length;if(hb)fb.forEach(function(jb){new Function(jb).apply();});eb.setAttribute('id',eb.id+'_'+this._root.id);var ib=this._getQueuedStories();ib.slice(0,-this._maxQueueLength).forEach(p.remove);if(hb)this._fetchedStories[eb.id]=true;},_cleanup:function(){db._placeholders.pagelet_rhc_ticker=null;if(!v.byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(i.unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var eb in this._listeners)this._listeners[eb]&&this._listeners[eb].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();i.inform('Ticker/cleanup');},_onNavHandler:function(eb,fb){var gb=fb.params.key;if(gb!='lf'&&gb!='h')this._cleanup();},registerStoryDialog:function(eb,fb){if(this._uaCurStoryIDFetch==eb.id)this._uaCurStoryIDFetch=null;if(this._uaCurStoryIDPrefetch==eb.id)this._uaCurStoryIDPrefetch=null;this._fetchedStories[eb.id]=true;this._fetchedStoriesDialog[eb.id]=fb;fb.setContext(eb);fb.subscribe('hide',this._deactivateStory.bind(this,true));fb.subscribe('success',this._focusStory.bind(this,eb));fb.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){fb.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));fb.subscribe('mouseleave',this._scheduleHide.bind(this));fb.subscribe('show',function(){setTimeout(this._highlightDialogScrollbar.bind(this,fb),0);var gb=g.listen(fb.getContent(),'mousedown',function(){this._selectStory(eb);gb.remove();}.bind(this));}.bind(this));}if(eb==this._activeStory)this._openDialog(fb);},_highlightDialogScrollbar:function(eb){var fb=p.scry(eb.getContent(),'.uiScrollableArea')[0];fb&&y.poke(fb);},_openStoryExternally:function(eb,event){var fb=eb.getAttribute('data-href');if(!fb||fb=='#')return;var gb=eb.getAttribute('data-story-rel');switch(gb){case 'theater':this._deactivateAndClearStory();l.loadModules(["PhotoViewer"],function(jb){jb.bootstrap(fb,eb);});return;case 'async':this._deactivateAndClearStory();j.bootstrap(fb,eb);return;}var hb=eb.getAttribute('data-target'),ib=(event.which!=1||event.getModifiers().any||hb=='_blank');ib?window.open(fb,'_blank'):va(fb);},_deactivateAndClearStory:function(){this._clearHoverTimeouts();this._deactivateStory();},_focusStoryWillTriggerScroll:function(eb){var fb=this._container,gb=fb.clientHeight,hb=eb.offsetHeight,ib=fb.scrollTop,jb=ib+gb,kb=eb.offsetTop,lb=kb+hb;return kb<ib||lb>jb;},_focusStory:function(eb){if(this._focusStoryWillTriggerScroll(eb))this._preventScrollDismiss=true;var fb=new w(eb),gb=v.byClass(eb,'scrollable'),hb=fb.boundWithin(new w(gb)).getPositionVector(),ib=fb.getPositionVector().sub(hb);if(ib.y!==0)ib.scrollElementBy(gb);eb.focus();},_selectStory:function(eb){this._selectedStory=eb;o.addClass(eb,'tickerStorySelected');o.addClass(this._root,'tickerChildSelected');},_activateStory:function(eb,fb){this._clearHoverTimeouts();if(eb==this._activeStory||!this._storyCanOpenDialog(eb))return;this._deactivateStory();this._focusStory(eb);this._activeStory=eb;o.addClass(eb,'tickerStoryActive');window.Toggler&&ca.hide();if(this._logFlyouts){fb=fb||'unknown';new k('/ajax/feed/ticker/flyout.php',{src:fb}).send();}ba.log(eb);var gb=this._getStoryDialog(eb);if(gb){if(this._storyDialogResources[eb.id])l.loadResources(this._storyDialogResources[eb.id]);this._openDialog(gb);ja.bumpEntityKey('ticker_stories','flyouts.open');return;}if(!(eb.id in this._fetchedStories))this._uaCurStoryIDFetch=eb.id;this._fetchStory(eb);},handleRemoveStory:function(){this._deactivateStory(true);},_deactivateStory:function(eb){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(eb){this._dialog.enableBehavior(s);}else this._dialog.disableBehavior(s);this._dialog.hide();}if(this._activeStory){o.removeClass(this._activeStory,'tickerStoryActive');o.removeClass(this._activeStory,'tickerStorySelected');o.removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function(eb,fb,event){la(fb,eb,event,'FORCE');},_fetchStory:function(eb){clearTimeout(this._fetchToken);var fb=[],gb=this._getInsertedStories(),hb=gb.indexOf(eb);[-1,0,1].forEach(function(ib){var jb=gb[hb+ib];jb&&fb.push(jb);},this);this._fetchToken=setTimeout(this._fetchStories.bind(this,fb),100);},_fetchStories:function(eb){var fb=[],gb,hb=function(ib){clearTimeout(gb);eb.forEach(function(jb){o.conditionClass(jb,'tickerStoryFetching',ib);});};eb=eb.filter(function(ib){if(ib.id in this._fetchedStories)return false;this._fetchedStories[ib.id]=true;var jb=this._getStoryDialogParams(ib);if(!jb)return false;jb.uniq_id=ib.getAttribute('id');jb.referrer=this._tickerSource;fb.push(jb);return true;},this);if(!fb.length)return;gb=this._setTimeout(hb.bind(null,true),500);new j('/ajax/feed/ticker/multi_story').setInitialHandler(this._handleDialogResponse.bind(this,fb)).setFinallyHandler(hb.bind(null,false)).setErrorHandler(sa).setData({stories:fb}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_handleDialogResponse:function(eb,fb){if(fb&&fb.resource_map){var gb=[];for(var hb in fb.resource_map){var ib=fb.resource_map[hb];if(ib.type==='css'&&!ib.permanent)gb.push(hb);}if(gb.length>0)for(var jb=0;jb<eb.length;jb++)this._storyDialogResources[eb[jb].uniq_id]=gb;}},_tickerDeClicker:function(event){var eb=event.getTarget(),fb=v.byTag(eb,'a'),gb=this._getStoryFromNode(eb),hb=this._getButtonFromNode(eb);if(gb&&fb&&!hb&&o.hasClass(gb,'tickerStoryClickable')&&!o.hasClass(fb,'tickerStoryAllowClick')&&!this._storyIsHidden(gb))fb.setAttribute('rel','ignore');var ib=(event.button==2),jb=(event.type==='keydown'),kb=gb&&this._getActionButtonFromStory(gb);if(!ib&&kb&&!jb)this._setClickedStory(gb);},_handleMouseup:function(event){this._clearClickedStory();},_setClickedStory:function(eb){this._clearClickedStory();o.addClass(eb,'tickerStoryClicked');this._clickedStory=eb;},_clearClickedStory:function(){if(this._clickedStory){o.removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function(){var eb=this._getInsertedStories();if(this._storiesWithActions)for(var fb=0;fb<eb.length;fb++){var gb=eb[fb];if(o.hasClass(gb,'tickerStoryWithButton'))this._storiesWithActions[gb.getAttribute('data-story-key')]=gb;}var hb=Math.max(0,eb.length-this._autoloadStoryIndex);this._infiniteScrollStory=eb[hb];this._checkInfiniteScroll();},_checkInfiniteScroll:function(){if(this._infiniteScrollStory){var eb=ha.getElementPosition(this._infiniteScrollStory).y,fb=ha.getElementPosition(this._container).y+ha.getElementDimensions(this._container).y;if(eb<fb){var gb=p.scry(this._root,'.tickerMorePager a')[0];if(gb){var hb=v.byClass(gb,'stat_elem')||gb;new j(gb.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(gb).setStatusElement(hb).setAllowCrossPageTransition(true).send();}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function(eb){if(!this._selectedStory)return;var fb=this._getStoryDialog(this._selectedStory);if(fb){fb.setFixed&&fb.setFixed(eb);fb.updatePosition();}},_setTimeout:function(eb,fb){return setTimeout(eb,fb,!this._tickerInSidebarMode);},_scrollDialogToBottom:function(){var eb=this._dialog&&this._dialog.getContent(),fb=eb&&p.scry(eb,'.uiScrollableAreaWrap')[0],gb=fb&&y.getInstance(fb);gb&&gb.scrollToBottom();},_redrawFlyout:function(eb,fb){if(this._hasUFIUpdated)return;var gb=this._dialog;if(gb&&gb.isShown()&&na(gb.getContent(),fb.form)){this._hasUFIUpdated=true;this._updateDialogPosition();}},_openDialog:function(eb){if(!this._tickerInSidebarMode)o.addClass(eb.getRoot(),'tickerStoryOverlayOnTop');this._hasUFIUpdated=false;var fb=ia.getScrollPosition();this._dialog=eb.show();window.scrollTo(fb.x,fb.y);this._updateDialogPosition();this._writeSwfFrame(eb);setTimeout(this._initCommentFocusListener.bind(this),0);setTimeout(this._initContentResizeListener.bind(this),0);this._stupidIE7VideoResizeHack(eb);},_stupidIE7VideoResizeHack:function(eb){if(ga.ie()===7){var fb=p.scry(eb.getContent(),'.uiVideoThumb .img');fb.forEach(function(gb){aa.set(gb,'width','');});}},_updateDialogPosition:function(){var eb=this._tickerInSidebarMode||!!v.byClass(this._root,'fixed_elem');this._dialog.setFixed&&this._dialog.setFixed(eb);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function(eb){var fb=this._dialog&&this._dialog.getContent(),gb=p.scry(fb,'.swfObject')[0];if(!gb)return;var hb=gb.getAttribute('data-swfid');if(hb&&window[hb]){var ib=window[hb];ib.write(gb);}},_initCommentFocusListener:function(){var eb=this._dialog&&this._dialog.getContent(),fb=eb&&p.scry(eb,'.tickerDialogFooter textarea')[0];if(!fb)return;this._listeners.inputFocus=g.listen(fb,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function(){var eb=this._dialog&&this._dialog.getContent();if(!eb)return;this._listeners.contentResize=g.listen(eb,'click',function(){setTimeout(this._dialog.updatePosition.bind(this._dialog),0);}.bind(this));},_cleanupContentResizeListener:function(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function(){var eb=this._dialog&&this._dialog.getContent(),fb=eb&&p.scry(eb,'.uiScrollableAreaWrap')[0];if(!fb)return;var gb=ha.getElementDimensions(fb),hb=ha.getElementPosition(fb),ib=p.scry(fb,'.uiUfi .uiUfiComment'),jb=p.scry(fb,"._12tg")[0],kb=p.scry(fb,".UFILikeSentence")[0],lb=this.FLYOUT_MAX_HEIGHT;if(jb||kb){var mb=this._getUfiItemAndTop(jb,kb),nb=mb[0],ob=mb[1];lb=Math.max(lb,this.FLYOUT_TARGET_HEIGHT_OFFSET+fb.scrollTop+ob+nb.offsetHeight-hb.y);}var pb=ha.getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING;lb=Math.min(lb,pb);var qb=lb-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var rb=0;rb<ib.length;rb++){var sb=ib[rb],tb=ha.getElementPosition(sb),ub=tb.y-hb.y;if(Math.abs(ub-qb)<=this.FLYOUT_OFFSET_THRESHOLD){qb=ub+this.FLYOUT_COMMENT_OFFSET;break;}}if(gb.y>=qb){aa.set(fb,'height',qb+'px');aa.set(fb,'max-height',null);}else{aa.set(fb,'max-height',lb+'px');aa.set(fb,'height',null);}},_getUfiItemAndTop:function(eb,fb){var gb=(eb&&ha.getElementPosition(eb).y)||0,hb=(fb&&ha.getElementPosition(fb).y)||0,ib=[eb,gb+this.FLYOUT_ACTION_FOOTER_PADDING],jb=[fb,hb];return gb>hb?ib:jb;},_initObjectIDs:function(){var eb=this._getAllStories();for(var fb=eb.length-1;fb>=0;fb--){var gb=eb[fb].getAttribute('data-story-key');if(gb){this._objectIDs[gb]=true;this._lastKStoriesInsert(eb[fb]);var hb=eb[fb].getAttribute("data-dedupe-key");if(hb)this._dedupeKeys[hb]=true;}}},_handleChatOpened:function(){this._deactivateStory();},_handleChannelConnection:function(){this._checkChannelConnection();},getNewest:function(){return this._newest;}});e.exports=db;},null);
__d("TickerRightColumnController",["Arbiter","CSS","DOM","Event","NavigationMessage","Run","Style","SubscriptionsHandler","TickerController","Vector","ge","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s;function t(){var y=q('pagelet_rhc_ticker');y&&o.show(y,v);}function u(){var y=q('pagelet_rhc_ticker');y&&o.hide(y);}function v(){var y=q('pagelet_rhc_ticker'),z=i.scry(y,'.ticker_container')[0],aa=i.scry(y,'.ticker_stream')[0],ba=q('rightCol');if(!y||!z||!aa||!ba)return;m.set(z,'height','0');var ca=75,da=p.getViewportDimensions().y,ea=p.getElementDimensions(ba).y,fa=da-ea-ca,ga=p.getElementDimensions(aa).y,ha=Math.max(Math.min(fa,ga,s.tickerMaxHeight||425),s.tickerMinHeight||225);m.set(z,'height',ha+'px');}function w(y){var z=q('pagelet_reminders'),aa=q('pagelet_rhc_ticker'),ba=z&&i.scry(z,'div.tickerToggleWrapper')[0],ca=aa&&i.scry(aa,'div.tickerToggleWrapper')[0];ba&&h.conditionClass(ba,'displayedTickerToggleWrapper',!y);ca&&h.conditionClass(ca,'displayedTickerToggleWrapper',y);aa&&h.conditionClass(aa,'hidden_rhc_ticker',!y);if(y){v();var da=q('fbTickerClosedEd');da&&h.hide(da);}}var x={init:function(y){s=y;var z=new n();if(s.enableSidebar)z.addSubscriptions(g.subscribe('sidebar/hide',t),g.subscribe('sidebar/show',u),g.subscribe('minisidebar/show',t),g.subscribe('LitestandClassicRHC/loaded',v),j.listen(window,'scroll',r(function(){var ba=i.scry(q('pagelet_rhc_ticker'),'.fbFeedTicker')[0],ca=ba&&o.getInstance(ba);ca&&ca.handleRemoveStory();})));if(!h.hasClass(document.documentElement,'sidebarMode')){t();}else if(s.enableSidebar)h.hasClass(document.documentElement,'miniSidebar')?t():u();var aa=function(){z.release();};g.subscribeOnce(k.NAVIGATION_BEGIN,aa);l.onLeave(aa);},initRHCTickerHider:function(y){j.listen(y,'click',this.hideRHCTicker);},showRHCTicker:function(){w(true);},hideRHCTicker:function(){w(false);}};e.exports=x;},null);