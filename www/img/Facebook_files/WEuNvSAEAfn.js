/*!CK:3265079671!*//*1433852144,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["oPm+T"]); }

__d("MercuryTypingAnimation.react",["React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=g,k=j.PropTypes,l=g.createClass({displayName:"MercuryTypingAnimation",propTypes:{color:k.oneOf(['light','dark'])},getDefaultProps:function(){return {color:'dark'};},render:function(){var m=(("_4a0v")+(this.props.color==='light'?' '+"_4a0w":'')+(this.props.color==='dark'?' '+"_4a0x":''));return (g.createElement("div",{className:i(this.props.className,m)},g.createElement("div",{className:"_4b0g"},g.createElement("div",{className:"_5pd7"}),g.createElement("div",{className:"_5pd7"}),g.createElement("div",{className:"_5pd7"}))));}});e.exports=l;},null);
__d("ChatTypingIndicator.react",["ChatAuthorPhotoBlock.react","MercuryTypingAnimation.react","ReactComponentWithPureRenderMixin","React","cx"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=j,m=l.PropTypes,n=j.createClass({displayName:"ChatTypingIndicator",mixins:[i],propTypes:{userID:m.string,showName:m.bool},render:function(){var o=this.props,p=o.userID,q=o.showName;return (j.createElement(g,{authorID:p,className:(("_gfq")+(q?' '+"_52fu":'')),hideName:!q},j.createElement("div",{className:"_52ft"},j.createElement(h,{className:"_3e2s",ref:"bubble"}))));},getBubble:function(){return this.refs.bubble;}});e.exports=n;},null);
__d("ChatTypingIndicators.react",["ChatTypingIndicator.react","DOM","MercuryIDs","MercuryParticipants","React","SubscriptionsHandler","Tooltip","createObjectFrom","cx","emptyFunction","fbt","joinClasses","MercuryThreadInformer","MercuryTypingReceiver"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){b.__markCompiled&&b.__markCompiled();var s=b('MercuryThreadInformer').get(),t=b('MercuryTypingReceiver').get(),u=k,v=u.PropTypes,w=k.createClass({displayName:"ChatTypingIndicators",propTypes:{indicatorClass:v.func,indicatorsWillShow:v.func,indicatorsDidShow:v.func,rootClassName:v.string,threadID:v.string.isRequired},getDefaultProps:function(){return {indicatorClass:g,indicatorsWillShow:p,indicatorsDidShow:p};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){this._subscriptions=new l();this._subscriptions.addSubscriptions(t.addRetroactiveListener('state-changed',this.typingStateChanged),s.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(x){if(x.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(x,y){if(y.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();j.getMulti(this.state.typingUserIDs,function(x){if(this.isMounted())this.state.typingUserIDs.forEach(function(y){var z=x[y],aa=this.refs[y].getBubble();if(aa)m.set(k.findDOMNode(aa),this.renderTooltip(z.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var x=i.isGroupChat(this.props.threadID);return (k.createElement("div",{className:r(this.props.rootClassName,"_2fsr")},this.state.typingUserIDs.map(function(y){return this._renderTypingIndicator(y,!!x);}.bind(this))));},_renderTypingIndicator:function(x,y){var z=this.props.indicatorClass;return (k.createElement(z,{key:x,ref:x,showName:y,userID:x}));},renderTooltip:function(x){var y=h.create('span');k.render(k.createElement("span",null,q._("{name} pisze...",[q.param("name",x)])),y);return y;},typingStateChanged:function(x){if(this.props.threadID in x)this.setState({typingUserIDs:x[this.props.threadID].slice().sort()});},messagesReceived:function(x,y){if(this.props.threadID in y){var z=y[this.props.threadID],aa=n(z.map(function(ba){return ba.author;}));this.setState({typingUserIDs:this.state.typingUserIDs.filter(function(ba){return !aa[ba];}).sort()});}}});e.exports=w;},null);
__d("MercurySpoofWarning.react",["MercuryParticipants","React","fbt"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=h,k=j.PropTypes,l=h.createClass({displayName:"MercurySpoofWarning",propTypes:{authorID:k.string.isRequired},getInitialState:function(){return {author:{name:''}};},componentWillMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(m){g.get(m.authorID,function(n){return this.setState({author:n});}.bind(this));},render:function(){return (h.createElement("div",h.__spread({},this.props),i._("Nie mo\u017cna potwierdzi\u0107, \u017ce nadawc\u0105 jest {name_or_email}.",[i.param("name_or_email",this.state.author.name)])));}});e.exports=l;},null);
__d("MercuryTypingIndicator",["Animation","Bootloader","BootloadedComponent.react","ChatConfig","CSS","DOM","MercuryViewer","MercuryParticipants","React","Style","ChatTabTemplates","Tooltip","copyProperties","csx","cx","fbt","MercuryTypingReceiver","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b.__markCompiled&&b.__markCompiled();var w=b('MercuryTypingReceiver').get(),x=b('MercuryThreadInformer').get(),y=[];x.subscribe('messages-received',function(ba,ca){y.forEach(function(da){var ea=ca[da._threadID];ea&&da.receivedMessages(ea);});});w.addRetroactiveListener('state-changed',function(ba){y.forEach(function(ca){var da=ba[ca._threadID];da&&ca._handleStateChanged(da);});});function z(ba){var ca=q[':fb:chat:conversation:message-group'].build(),da=q[':fb:mercury:typing-indicator:typing'].build(),ea=ca.getNode('profileLink');r.set(ea,ba.name,'left');ea.href=ba.href;ca.setNodeContent('profileName',ba.name);ca.setNodeProperty('profilePhoto','src',ba.image_src);var fa=v._("{name} pisze...",[v.param("name",ba.short_name)]);r.set(da.getRoot(),fa,'above');l.appendContent(ca.getNode('messages'),da.getRoot());return ca;}function aa(ba,ca,da){this._animations={};this._activeUsers={};this._typingIndicator=ca;this._messagesView=da;this._threadID=ba;this._subscription=w.addRetroactiveListener('state-changed',function(ea){var fa=ea[this._threadID];fa&&this._handleStateChanged(fa);}.bind(this));y.push(this);}s(aa.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();y.remove(this);},receivedMessages:function(ba){ba.forEach(function(ca){if(!m.isViewer(ca.author))this._removeUserBubble(ca.author);}.bind(this));},_handleStateChanged:function(ba){for(var ca in this._activeUsers)if(ba.indexOf(ca)===-1){this._slideOutUserBubble(ca);delete this._activeUsers[ca];}if(ba.length)n.getMulti(ba,function(da){var ea=this._messagesView.isScrolledToBottom(),fa={};for(var ga in da){var ha=this._activeUsers[ga];fa[ga]=ha||z(da[ga]).getRoot();if(!ha){l.appendContent(this._typingIndicator,fa[ga]);if(j.get('chat_thread_typing_indicator_animated')){var ia=l.scry(this._typingIndicator,"._510u");for(var ja=0,ka=ia.length;ja<ka;ja++)o.render(o.createElement(i,{bootloadPlaceholder:o.createElement("span",null),bootloadComponent:function(ma){h.loadModules(["MercuryTypingAnimation.react"],ma);},className:"_3e2s"}),ia[ja]);}}}var la=Object.keys(fa).length>0;ea&&this._messagesView.scrollToBottom(la);this._activeUsers=fa;}.bind(this));},_removeUserBubble:function(ba,ca){var da=this._getCurrentAnimation(ba,ca);if(da){da.animation.stop();l.remove(da.elem);delete this._animations[ba];}if(ba in this._activeUsers){l.remove(this._activeUsers[ba]);delete this._activeUsers[ba];}if(ca&&j.get('chat_thread_typing_indicator_animated')){var ea=l.scry(ca,"._510u");for(var fa=0,ga=ea.length;fa<ga;fa++)o.unmountComponentAtNode(ea[fa]);}ca&&l.remove(ca);},_slideOutUserBubble:function(ba){var ca=this._activeUsers[ba];if(this._getCurrentAnimation(ba,ca)){return;}else if(ca){p.set(ca,'overflow','hidden');var da=(new g(ca)).from('opacity',1).from('height',ca.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,ba,ca)).go();this._animations[ba]={animation:da,elem:ca};}},_getCurrentAnimation:function(ba,ca){if(this._animations[ba]&&(!ca||this._animations[ba].elem===ca))return this._animations[ba];}});e.exports=aa;},null);